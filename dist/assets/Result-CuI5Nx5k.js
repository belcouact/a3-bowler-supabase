import{W as N,Z as H,al as C,r as i,O as t,a4 as A,am as h}from"./index-BZhcN-Wz.js";import{I as R}from"./ImageCanvas-I1pM-eIo.js";const D=()=>{const{id:x}=N(),{a3Cases:p,updateA3Case:n,isLoading:v}=H(),{user:a}=C(),e=p.find(s=>s.id===x),l=i.useRef(null),[f,u]=i.useState([]),[g,c]=i.useState(500),y=async s=>!e||!(a!=null&&a.username)?URL.createObjectURL(s):(await h.uploadA3Image(a.username,e.id,s)).url;i.useEffect(()=>{if(e){e.resultImages&&JSON.stringify(e.resultImages)!==JSON.stringify(f)&&u(e.resultImages||[]),e.resultCanvasHeight&&e.resultCanvasHeight!==g&&c(e.resultCanvasHeight);const s=e.results||"";l.current&&l.current.value!==s&&(l.current.value=s)}},[e==null?void 0:e.id]),i.useEffect(()=>{if(!e||!(a!=null&&a.username)||Array.isArray(e.resultImages)&&e.resultImages.length>0)return;let m=!1;return(async()=>{try{const r=await h.loadA3Detail(a.username,e.id);if(!r||!r.success||m)return;const d={...e};let o=!1;Array.isArray(r.resultImages)&&(u(r.resultImages),d.resultImages=r.resultImages,o=!0),typeof r.resultCanvasHeight=="number"&&(c(r.resultCanvasHeight),d.resultCanvasHeight=r.resultCanvasHeight,o=!0),o&&n(d)}catch{}})(),()=>{m=!0}},[e==null?void 0:e.id,a==null?void 0:a.username,n]);const j=s=>{u(s),e&&n({...e,resultImages:s})},b=s=>{c(s),e&&n({...e,resultCanvasHeight:s})},I=()=>{if(e&&l.current){const s=l.current.value;s!==e.results&&n({...e,results:s})}};return v?t.jsx("div",{className:"flex items-center justify-center py-16",children:t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx(A,{className:"w-8 h-8 animate-spin text-blue-600"}),t.jsx("p",{className:"mt-3 text-base font-medium text-gray-700",children:"Loading A3 Results & Follow-up..."})]})}):e?t.jsx("div",{className:"space-y-6",children:t.jsxs("div",{children:[t.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Results & Follow-up"}),t.jsx("p",{className:"text-gray-500 mb-4",children:"Document the results achieved after implementing the action plan."}),t.jsx(R,{images:f,onImagesChange:j,height:g,onHeightChange:b,label:"Result Evidence (Paste or Upload Images)",onUploadImage:y}),t.jsx("div",{className:"space-y-4 mt-6",children:t.jsxs("div",{children:[t.jsx("label",{htmlFor:"results",className:"block text-sm font-medium text-gray-700 mb-1",children:"Actual Results"}),t.jsx("textarea",{ref:l,id:"results",rows:8,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-3 border",placeholder:"Describe what happened after actions were taken...",defaultValue:e.results||"",onBlur:I})]})})]})}):t.jsx("div",{className:"flex items-center justify-center py-16",children:t.jsxs("div",{className:"flex flex-col items-center text-center",children:[t.jsx("p",{className:"mt-3 text-base font-medium text-gray-800",children:"A3 case could not be found."}),t.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"It may have been deleted or the link is invalid."})]})})};export{D as default};
