import{c as te,r as l,O as r,d as B,aj as U,aa as re}from"./index-BHui7Ahz.js";import{Z as se,a as oe}from"./zoom-out-BCjTh-Fe.js";import{T as ne}from"./trash-2-CLMLu7Rn.js";/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=te("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]),p=200,b=80,q=[{name:"White",value:"#ffffff",border:"#e2e8f0"},{name:"Blue",value:"#eff6ff",border:"#bfdbfe"},{name:"Green",value:"#f0fdf4",border:"#bbf7d0"},{name:"Yellow",value:"#fefce8",border:"#fef08a"},{name:"Red",value:"#fef2f2",border:"#fecaca"},{name:"Purple",value:"#faf5ff",border:"#e9d5ff"}],ce=({node:t,onUpdate:y,onAdd:g,onDelete:Y,onMouseDown:j})=>{var H;const m=l.useRef(null),c=l.useRef(null),[v,f]=l.useState(!1),N=l.useRef(t);l.useLayoutEffect(()=>{N.current=t}),l.useLayoutEffect(()=>{if(m.current&&!t.customHeight){m.current.style.height="auto";const o=m.current.scrollHeight;m.current.style.height=o+"px"}},[t.text,t.customHeight]),l.useEffect(()=>{if(!c.current)return;const o=new ResizeObserver(k=>{for(const L of k)requestAnimationFrame(()=>{const C=L.target,w=N.current,M=C.offsetWidth,d=C.offsetHeight;(Math.abs((w.width||p)-M)>5||Math.abs((w.height||b)-d)>5)&&y(w.id,{width:M,height:d})})});return o.observe(c.current),()=>o.disconnect()},[y]);const R=o=>{var P,z;o.stopPropagation(),o.preventDefault();const k=o.clientX,L=o.clientY,C=((P=c.current)==null?void 0:P.offsetWidth)||p,w=((z=c.current)==null?void 0:z.offsetHeight)||b,M=S=>{const W=S.clientX-k,$=S.clientY-L,X=Math.max(100,C+W),I=Math.max(50,w+$);y(t.id,{customWidth:X,customHeight:I,width:X,height:I})},d=()=>{window.removeEventListener("mousemove",M),window.removeEventListener("mouseup",d)};window.addEventListener("mousemove",M),window.addEventListener("mouseup",d)};return r.jsxs("div",{ref:c,style:{transform:`translate(${t.x}px, ${t.y}px)`,width:t.customWidth||p,height:t.customHeight,backgroundColor:t.color||(t.type==="root"?"#eff6ff":"#ffffff"),borderColor:t.color?(H=q.find(o=>o.value===t.color))==null?void 0:H.border:void 0},className:B("absolute flex flex-col p-3 rounded-lg shadow-sm border transition-shadow group select-none",!t.color&&(t.type==="root"?"bg-blue-50 border-blue-200":"bg-white border-slate-200 hover:border-blue-300")),children:[r.jsxs("div",{className:"flex justify-between items-center mb-2 cursor-grab active:cursor-grabbing border-b border-transparent group-hover:border-slate-100 pb-1 relative",onMouseDown:o=>j(o,t.id),children:[r.jsx("span",{className:"text-[10px] font-bold uppercase tracking-wider text-slate-400",children:t.type==="root"?"PROBLEM":"WHY?"}),r.jsxs("div",{className:"flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity items-center",children:[r.jsxs("div",{className:"relative",children:[r.jsx("button",{onClick:o=>{o.stopPropagation(),f(!v)},className:"p-1 hover:bg-slate-100 text-slate-400 hover:text-slate-600 rounded",title:"Change Color",children:r.jsx(ae,{className:"w-3 h-3"})}),v&&r.jsx("div",{className:"absolute top-full right-0 mt-1 p-2 bg-white rounded-lg shadow-xl border border-gray-200 flex gap-1 z-[70] min-w-[140px] flex-wrap",onMouseDown:o=>o.stopPropagation(),children:q.map(o=>r.jsx("button",{className:"w-6 h-6 rounded-full border border-gray-200 hover:scale-110 transition-transform",style:{backgroundColor:o.value},onClick:k=>{k.stopPropagation(),y(t.id,{color:o.value}),f(!1)},title:o.name},o.name))})]}),t.type!=="root"&&r.jsx("button",{onClick:()=>Y(t.id),className:"p-1 hover:bg-red-50 text-slate-400 hover:text-red-500 rounded",title:"Delete branch",children:r.jsx(ne,{className:"w-3 h-3"})}),r.jsx("button",{onClick:()=>g(t.id,"right"),className:"p-1 hover:bg-blue-50 text-slate-400 hover:text-blue-500 rounded",title:"Add next Why (Right)",children:r.jsx(U,{className:"w-3 h-3"})})]})]}),r.jsx("textarea",{ref:m,value:t.text,onChange:o=>y(t.id,{text:o.target.value}),style:{height:t.customHeight?"100%":void 0,resize:"none"},className:B("w-full text-sm bg-transparent border-none focus:ring-0 p-0 text-slate-700 font-medium overflow-hidden",t.customHeight?"flex-1":""),rows:1,placeholder:t.type==="root"?"Describe the problem...":"Ask why...",onMouseDown:o=>o.stopPropagation()}),r.jsx("div",{className:"absolute bottom-0 right-0 w-4 h-4 cursor-se-resize flex items-center justify-center opacity-0 group-hover:opacity-100 z-20",onMouseDown:R,title:"Resize",children:r.jsx("div",{className:"w-2 h-2 border-r-2 border-b-2 border-slate-300"})}),r.jsx("button",{className:"absolute -bottom-3 left-1/2 transform -translate-x-1/2 bg-white border border-slate-200 rounded-full p-1 shadow-sm opacity-0 group-hover:opacity-100 transition-opacity hover:bg-blue-50 text-slate-400 hover:text-blue-500 z-10",onClick:()=>g(t.id,"bottom"),title:"Add Why below",children:r.jsx(U,{className:"w-3 h-3"})})]})},he=({initialNodes:t,onChange:y,autoHeight:g,initialScale:Y,fixedHeight:j,onViewChange:m})=>{const[c,v]=l.useState(t&&t.length>0?t:[{id:"root",text:"Define the Problem",x:50,y:250,width:p,height:b,parentId:null,type:"root"}]),[f,N]=l.useState(Y??1),[R,H]=l.useState(null),[o,k]=l.useState({x:0,y:0}),[L,C]=l.useState(!1),w=l.useRef({x:0,y:0}),M=l.useRef([]),d=l.useRef(null),P=l.useRef(y),[z,S]=l.useState(j??600),W=l.useRef({h:0,y:0});l.useEffect(()=>{P.current=y},[y]),l.useEffect(()=>{P.current&&P.current(c)},[c]),l.useEffect(()=>{if(!g||c.length===0)return;const e=Math.min(...c.map(s=>s.y)),n=Math.max(...c.map(s=>s.y+(s.height||b)))-e+100;S(Math.max(300,n))},[c,g]),l.useEffect(()=>{g||j&&j!==z&&S(j)},[j,g,z]),l.useEffect(()=>{t&&t.length>0&&R===null&&(v(e=>e===t||JSON.stringify(e)===JSON.stringify(t)?e:t),N(Y!==void 0?Y:1))},[t,R,Y]);const $=e=>{if(g||!d.current)return;e.stopPropagation(),W.current={h:d.current.clientHeight,y:e.clientY};const a=s=>{const i=s.clientY-W.current.y,u=Math.max(300,W.current.h+i);S(u)},n=()=>{document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",n),m&&d.current&&m({scale:f,height:d.current.clientHeight})};document.addEventListener("mousemove",a),document.addEventListener("mouseup",n)},X=(e,a)=>{e.stopPropagation();const n=c.find(h=>h.id===a);if(!n||!d.current)return;const s=d.current.getBoundingClientRect(),i=(e.clientX-s.left)/f,u=(e.clientY-s.top)/f;k({x:i-n.x,y:u-n.y}),H(a)},I=e=>{e.button===0&&(R||(C(!0),w.current={x:e.clientX,y:e.clientY},M.current=c))},G=e=>{if(L){const i=(e.clientX-w.current.x)/f,u=(e.clientY-w.current.y)/f,h=M.current;v(h.map(x=>({...x,x:x.x+i,y:x.y+u})));return}if(!R||!d.current)return;const a=d.current.getBoundingClientRect(),n=(e.clientX-a.left)/f,s=(e.clientY-a.top)/f;v(c.map(i=>i.id===R?{...i,x:n-o.x,y:s-o.y}:i))},F=()=>{H(null),C(!1)},J=(e,a)=>{const n=c.find(i=>i.id===e);if(!n)return;const s={id:re(),text:"Why?",x:0,y:0,width:p,height:b,parentId:e,type:"child"};if(a==="bottom"){s.x=n.x,s.y=n.y+(n.height||b)+50;const i=c.filter(u=>u.parentId===e&&u.y>n.y+(n.height||b)/2);if(i.length>0){const u=Math.max(...i.map(h=>h.x));s.x=u+(p+20)}}else{s.x=n.x+(n.width||p)+50,s.y=n.y;const i=c.filter(u=>u.parentId===e&&u.x>n.x+(n.width||p)/2);if(i.length>0){const u=Math.max(...i.map(h=>h.y));s.y=u+(b+20)}}v([...c,s])},_=e=>{const a=s=>{const i=c.filter(h=>h.parentId===s);let u=i.map(h=>h.id);return i.forEach(h=>{u=[...u,...a(h.id)]}),u},n=[e,...a(e)];v(c.filter(s=>!n.includes(s.id)))},K=l.useCallback((e,a)=>{v(n=>n.map(s=>s.id===e?{...s,...a}:s))},[]),Q=()=>c.map(e=>{if(!e.parentId)return null;const a=c.find(ee=>ee.id===e.parentId);if(!a)return null;const n=a.width||p,s=a.height||b,i=e.width||p,u=e.height||b;let h,x,D,E,O,T,A,Z;e.y>=a.y+s-10?(h=a.x+n/2,x=a.y+s,D=e.x+i/2,E=e.y,O=h,T=x+(E-x)/2,A=D,Z=E-(E-x)/2):(h=a.x+n,x=a.y+s/2,D=e.x,E=e.y+u/2,O=h+(D-h)/2,T=x,A=D-(D-h)/2,Z=E);const V=`M ${h} ${x} C ${O} ${T}, ${A} ${Z}, ${D} ${E}`;return r.jsx("path",{d:V,stroke:"#475569",strokeWidth:"3",fill:"none"},`${a.id}-${e.id}`)});return r.jsx("div",{className:"flex flex-col space-y-2",children:r.jsxs("div",{ref:d,className:B("w-full bg-slate-50 relative overflow-hidden border border-slate-200 rounded-lg cursor-grab active:cursor-grabbing",!g&&"h-[600px]"),onMouseDown:I,style:{height:z},onMouseMove:G,onMouseUp:F,onMouseLeave:F,children:[r.jsxs("div",{className:"absolute top-4 right-4 z-20 flex items-center bg-white/80 rounded-md p-1 shadow backdrop-blur-sm border border-slate-200",children:[r.jsx("button",{onClick:()=>{const e=Math.max(.5,f-.1);N(e),m&&d.current&&m({scale:e,height:d.current.clientHeight})},className:"p-1 hover:bg-gray-100 rounded",title:"Zoom Out",children:r.jsx(se,{className:"w-4 h-4 text-gray-600"})}),r.jsxs("span",{className:"text-xs text-gray-500 w-12 text-center select-none",children:[Math.round(f*100),"%"]}),r.jsx("button",{onClick:()=>{const e=Math.min(2,f+.1);N(e),m&&d.current&&m({scale:e,height:d.current.clientHeight})},className:"p-1 hover:bg-gray-100 rounded",title:"Zoom In",children:r.jsx(oe,{className:"w-4 h-4 text-gray-600"})})]}),r.jsxs("div",{style:{transform:`scale(${f})`,transformOrigin:"0 0",width:"100%",height:"100%",position:"relative"},children:[r.jsx("svg",{className:"absolute top-0 left-0 w-full h-full pointer-events-none",style:{overflow:"visible",zIndex:0},width:"100%",height:"100%",children:Q()}),r.jsx("div",{className:"relative",style:{zIndex:10},children:c.map(e=>r.jsx(ce,{node:e,onUpdate:K,onAdd:J,onDelete:_,onMouseDown:X},e.id))})]}),!g&&r.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-4 bg-slate-100 hover:bg-slate-200 cursor-s-resize flex items-center justify-center border-t border-slate-200 z-30",onMouseDown:$,children:r.jsx("div",{className:"w-10 h-1 bg-slate-400 rounded-full"})})]})})};export{he as M};
