import{c as xe,aE as Ne,Y as Se,W as ke,r as t,O as e,X as Ce,aF as ue,aG as me}from"./index-Sntkv-gj.js";import{M as Pe}from"./MarkdownRenderer-Chi7RTmY.js";import{L as O,M as Ee}from"./mail-Cq0_CBlp.js";import{C as Me}from"./check-DrzMUj8A.js";/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=xe("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=xe("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),He=({isOpen:d,onClose:N})=>{const{user:r,refreshUser:U}=Ne(),a=Se(),{dashboardSettings:n,setDashboardSettings:Z}=ke(),[c,S]=t.useState("password"),[f,h]=t.useState(!1),[k,L]=t.useState(!1),[C,$]=t.useState(!1),[P,q]=t.useState(""),[E,Y]=t.useState(""),[G,z]=t.useState(""),[J,V]=t.useState(""),[X,_]=t.useState("China"),[K,Q]=t.useState("SZFTZ"),[ee,se]=t.useState("GBS"),[p,te]=t.useState(!0),[M,re]=t.useState(""),[x,ae]=t.useState(""),[u,F]=t.useState(""),[A,be]=t.useState(""),[le,y]=t.useState(null),[m,oe]=t.useState("weekly"),[g,ne]=t.useState(1),[j,ie]=t.useState(1),[w,de]=t.useState("08:00"),[b,ce]=t.useState("scheduled");if(t.useEffect(()=>{r&&(V(r.role||""),_(r.country||"China"),Q(r.plant||"SZFTZ"),se(r.team||"GBS"),te(r.isPublicProfile!==void 0?r.isPublicProfile:!0),r.email&&re(r.email))},[r,d]),t.useEffect(()=>{if(!d)return;const s=n.emailSchedule;s&&((s.frequency==="weekly"||s.frequency==="monthly")&&oe(s.frequency),typeof s.dayOfWeek=="number"&&ne(s.dayOfWeek),typeof s.dayOfMonth=="number"&&ie(s.dayOfMonth),s.timeOfDay&&de(s.timeOfDay))},[d,n.emailSchedule]),t.useEffect(()=>{d&&Z({...n,emailSchedule:{frequency:m,dayOfWeek:m==="weekly"?g:void 0,dayOfMonth:m==="monthly"?j:void 0,timeOfDay:w}})},[m,g,j,w,d,Z]),t.useEffect(()=>{d&&(u||n.latestSummaryForEmail&&(F(n.latestSummaryForEmail),n.latestSummaryHtmlForEmail?y(n.latestSummaryHtmlForEmail):y(null)))},[d,n.latestSummaryForEmail,u]),t.useEffect(()=>{d&&(x||ae(m==="weekly"?"Weekly A3 / metric summary":"Monthly A3 / metric summary"))},[d,m,x]),!d)return null;const he=async()=>{if(E!==G){a.error("New passwords don't match");return}if(!P){a.error("Please enter current password");return}h(!0);try{await ue.changePassword({username:r==null?void 0:r.username,oldPassword:P,newPassword:E}),a.success("Password updated successfully"),q(""),Y(""),z("")}catch(s){a.error(s.message||"Failed to update password")}finally{h(!1)}},fe=async()=>{h(!0);try{await ue.updateProfile({username:r==null?void 0:r.username,role:J,profile:{country:X,plant:K,team:ee,isPublic:p}}),a.success("Profile updated successfully");try{await U()}catch(s){console.warn("Background refresh failed:",s)}}catch(s){a.error(s.message||"Failed to update profile")}finally{h(!1)}},pe=async()=>{h(!0);try{await U(!0),a.success("Profile reloaded")}catch{a.error("Failed to reload profile")}finally{h(!1)}},ye=()=>{const s=new Date,[l,o]=w.split(":"),D=Number(l)||8,T=Number(o)||0;if(m==="weekly"){const i=new Date(s.getTime()),W=i.getDay(),B=g===7?0:g;i.setHours(D,T,0,0);let v=B-W;return(v<0||v===0&&i<=s)&&(v+=7),i.setDate(i.getDate()+v),i}const I=s.getFullYear(),R=s.getMonth(),we=new Date(I,R+1,0).getDate(),ve=Math.min(j,we);let H=new Date(I,R,ve,D,T,0,0);if(H<=s){const i=new Date(I,R+1,1),W=new Date(i.getFullYear(),i.getMonth()+1,0).getDate(),B=Math.min(j,W);H=new Date(i.getFullYear(),i.getMonth(),B,D,T,0,0)}return H},ge=async()=>{const s=M.split(/[,\n]/).map(o=>o.trim()).filter(o=>o.length>0);if(s.length===0){a.error("Please enter at least one recipient email");return}if(!x.trim()){a.error("Please enter an email subject");return}if(!u.trim()){a.error("Please enter an email body");return}let l=null;if(b==="scheduled")l=ye();else{if(!A){a.error("Please choose a send date and time");return}const o=new Date(A);if(Number.isNaN(o.getTime())){a.error("Please enter a valid date and time");return}l=o}L(!0);try{const o=(r==null?void 0:r.username)||void 0;await me.scheduleEmail({userId:o,recipients:s,subject:x.trim(),body:u.trim(),bodyHtml:le||void 0,sendAt:l.toISOString()}),a.success("Email scheduled successfully")}catch(o){a.error(o.message||"Failed to schedule email")}finally{L(!1)}},je=async()=>{const s=M.split(/[,\n]/).map(l=>l.trim()).filter(l=>l.length>0);if(s.length===0){a.error("Please enter at least one recipient email");return}if(!x.trim()){a.error("Please enter an email subject");return}if(!u.trim()){a.error("Please enter an email body");return}$(!0);try{const l=(r==null?void 0:r.username)||void 0;await me.sendEmailNow({userId:l,recipients:s,subject:x.trim(),body:u.trim(),bodyHtml:le||void 0}),a.success("Email sent successfully")}catch(l){a.error(l.message||"Failed to send email")}finally{$(!1)}};return e.jsx("div",{className:"fixed inset-0 z-[70] overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:N}),e.jsx("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true",children:"â€‹"}),e.jsxs("div",{className:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full",children:[e.jsxs("div",{className:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4 border-b border-gray-200 flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",id:"modal-title",children:"Account Settings"}),e.jsx("button",{onClick:N,className:"text-gray-400 hover:text-gray-500",children:e.jsx(Ce,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"flex border-b border-gray-200",children:[e.jsxs("button",{className:`flex-1 py-3 text-sm font-medium text-center flex items-center justify-center space-x-2 ${c==="password"?"border-b-2 border-blue-500 text-blue-600":"text-gray-500 hover:text-gray-700"}`,onClick:()=>S("password"),children:[e.jsx(O,{className:"w-4 h-4"}),e.jsx("span",{children:"Password"})]}),e.jsxs("button",{className:`flex-1 py-3 text-sm font-medium text-center flex items-center justify-center space-x-2 ${c==="profile"?"border-b-2 border-blue-500 text-blue-600":"text-gray-500 hover:text-gray-700"}`,onClick:()=>S("profile"),children:[e.jsx(Fe,{className:"w-4 h-4"}),e.jsx("span",{children:"Profile"})]}),e.jsxs("button",{className:`flex-1 py-3 text-sm font-medium text-center flex items-center justify-center space-x-2 ${c==="email"?"border-b-2 border-blue-500 text-blue-600":"text-gray-500 hover:text-gray-700"}`,onClick:()=>S("email"),children:[e.jsx(Ee,{className:"w-4 h-4"}),e.jsx("span",{children:"Email"})]})]}),e.jsxs("div",{className:"px-6 py-6",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"User: "}),e.jsx("span",{className:"font-semibold text-blue-600",children:r==null?void 0:r.username})]}),e.jsx("button",{onClick:pe,className:"p-1 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-full transition-colors",title:"Reload Profile from Server",children:e.jsx(Ae,{className:`w-4 h-4 ${f?"animate-spin":""}`})})]}),c==="password"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 uppercase mb-1",children:"Current Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(O,{className:"absolute left-3 top-2.5 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"password",value:P,onChange:s=>q(s.target.value),placeholder:"Enter current password",className:"pl-9 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm p-2 border"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 uppercase mb-1",children:"New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(O,{className:"absolute left-3 top-2.5 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"password",value:E,onChange:s=>Y(s.target.value),placeholder:"Enter new password",className:"pl-9 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm p-2 border"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 uppercase mb-1",children:"Confirm New Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(Me,{className:"absolute left-3 top-2.5 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"password",value:G,onChange:s=>z(s.target.value),placeholder:"Confirm new password",className:"pl-9 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm p-2 border"})]})]})]}),c==="profile"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 uppercase mb-1",children:"Role"}),e.jsx("input",{type:"text",value:J,onChange:s=>V(s.target.value),className:"block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm p-2 border"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 uppercase mb-1",children:"Region"}),e.jsxs("select",{value:X,onChange:s=>_(s.target.value),className:"block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm p-2 border",children:[e.jsx("option",{value:"China",children:"China"}),e.jsx("option",{value:"US",children:"US"}),e.jsx("option",{value:"EMEA",children:"EMEA"}),e.jsx("option",{value:"APAC",children:"APAC"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 uppercase mb-1",children:"Plant/Office"}),e.jsxs("select",{value:K,onChange:s=>Q(s.target.value),className:"block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm p-2 border",children:[e.jsx("option",{value:"BJ",children:"BJ"}),e.jsx("option",{value:"SH",children:"SH"}),e.jsx("option",{value:"TW",children:"TW"}),e.jsx("option",{value:"SZFTZ",children:"SZFTZ"}),e.jsx("option",{value:"SZBAN",children:"SZBAN"}),e.jsx("option",{value:"EM1",children:"EM1"}),e.jsx("option",{value:"EM5",children:"EM5"}),e.jsx("option",{value:"LOV",children:"LOV"}),e.jsx("option",{value:"PU3",children:"PU3"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 uppercase mb-1",children:"Functional Team"}),e.jsxs("select",{value:ee,onChange:s=>se(s.target.value),className:"block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm p-2 border",children:[e.jsx("option",{value:"Commercial",children:"Commercial"}),e.jsx("option",{value:"SC",children:"SC"}),e.jsx("option",{value:"Technical",children:"Technical"})]})]}),e.jsx("div",{className:"pt-2",children:e.jsxs("div",{className:"border border-gray-200 rounded-md p-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"Public Profile"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Allow others to consolidate your bowlers"})]}),e.jsx("button",{type:"button",className:`${p?"bg-blue-600":"bg-gray-200"} relative inline-flex flex-shrink-0 h-6 w-11 border-2 border-transparent rounded-full cursor-pointer transition-colors ease-in-out duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500`,role:"switch","aria-checked":p,onClick:()=>te(!p),children:e.jsx("span",{className:`${p?"translate-x-5":"translate-x-0"} pointer-events-none inline-block h-5 w-5 rounded-full bg-white shadow transform ring-0 transition ease-in-out duration-200`})})]})})]}),c==="email"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 uppercase mb-1",children:"Recipients"}),e.jsx("textarea",{value:M,onChange:s=>re(s.target.value),rows:2,placeholder:"user1@example.com, user2@example.com",className:"block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm p-2 border"}),e.jsx("p",{className:"mt-1 text-xs text-gray-400",children:"Separate multiple emails with commas or new lines."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 uppercase mb-1",children:"Subject"}),e.jsx("input",{type:"text",value:x,onChange:s=>ae(s.target.value),placeholder:"Weekly A3 / metric summary",className:"block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm p-2 border"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 uppercase mb-1",children:"Message"}),e.jsx("button",{type:"button",className:"text-xs px-2 py-1 rounded border border-blue-500 text-blue-600 hover:bg-blue-50",onClick:()=>{const s=n.latestSummaryForEmail;if(!s){a.error("No latest AI summary found. Please run one-click summary first.");return}F(s),n.latestSummaryHtmlForEmail?y(n.latestSummaryHtmlForEmail):y(null)},children:"Insert latest AI summary"})]}),e.jsx("textarea",{value:u,onChange:s=>{F(s.target.value),y(null)},rows:4,placeholder:"Add the summary or message you want to email.",className:"block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm p-2 border"}),u&&e.jsx("div",{className:"mt-3 border border-gray-200 rounded-md bg-gray-50 p-3 max-h-64 overflow-y-auto",children:e.jsx(Pe,{content:u})})]}),e.jsxs("div",{className:"mt-4 border rounded-md",children:[e.jsxs("div",{className:"flex text-xs font-medium border-b",children:[e.jsx("button",{type:"button",className:`flex-1 px-3 py-2 text-center ${b==="scheduled"?"bg-blue-50 text-blue-700 border-b-2 border-blue-500":"text-gray-500 hover:text-gray-700"}`,onClick:()=>ce("scheduled"),children:"Scheduled (repeat)"}),e.jsx("button",{type:"button",className:`flex-1 px-3 py-2 text-center ${b==="oneTime"?"bg-blue-50 text-blue-700 border-b-2 border-blue-500":"text-gray-500 hover:text-gray-700"}`,onClick:()=>ce("oneTime"),children:"One-time"})]}),e.jsxs("div",{className:"p-3 space-y-3",children:[b==="scheduled"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 uppercase mb-1",children:"Repeat"}),e.jsxs("select",{value:m,onChange:s=>oe(s.target.value),className:"block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm p-2 border",children:[e.jsx("option",{value:"weekly",children:"Every week"}),e.jsx("option",{value:"monthly",children:"Every month"})]})]}),e.jsx("div",{children:m==="weekly"?e.jsxs(e.Fragment,{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 uppercase mb-1",children:"Day of Week"}),e.jsxs("select",{value:g,onChange:s=>ne(Number(s.target.value)),className:"block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm p-2 border",children:[e.jsx("option",{value:1,children:"Monday"}),e.jsx("option",{value:2,children:"Tuesday"}),e.jsx("option",{value:3,children:"Wednesday"}),e.jsx("option",{value:4,children:"Thursday"}),e.jsx("option",{value:5,children:"Friday"}),e.jsx("option",{value:6,children:"Saturday"}),e.jsx("option",{value:7,children:"Sunday"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 uppercase mb-1",children:"Date of Month"}),e.jsx("select",{value:j,onChange:s=>ie(Number(s.target.value)),className:"block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm p-2 border",children:Array.from({length:31},(s,l)=>l+1).map(s=>e.jsx("option",{value:s,children:s},s))})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 uppercase mb-1",children:"Time"}),e.jsx("input",{type:"time",value:w,onChange:s=>de(s.target.value),className:"block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm p-2 border"}),e.jsx("p",{className:"mt-1 text-xs text-gray-400",children:"Saved to dashboard settings for recurring email schedule. Next send time is calculated automatically."})]})]}),b==="oneTime"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 uppercase mb-1",children:"Send At"}),e.jsx("input",{type:"datetime-local",value:A,onChange:s=>be(s.target.value),className:"block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm p-2 border"})]})]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse",children:[c==="password"&&e.jsx("button",{type:"button",className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm",onClick:he,disabled:f,children:f?"Updating...":"Update Password"}),c==="profile"&&e.jsx("button",{type:"button",className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm",onClick:fe,disabled:f,children:f?"Saving...":"Save Profile"}),c==="email"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm",onClick:ge,disabled:k||C,children:k?"Scheduling...":b==="scheduled"?"Schedule recurring email":"Schedule one-time email"}),b==="oneTime"&&e.jsx("button",{type:"button",className:"mt-3 w-full inline-flex justify-center rounded-md border border-blue-600 shadow-sm px-4 py-2 bg-white text-base font-medium text-blue-600 hover:bg-blue-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm",onClick:je,disabled:C||k,children:C?"Sending...":"Send Now"})]}),e.jsx("button",{type:"button",className:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm",onClick:N,children:c==="password"?"Cancel":"Close"})]})]})]})})};export{He as AccountSettingsModal};
