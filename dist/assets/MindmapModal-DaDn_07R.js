import{Z as K,r as s,O as e,al as Q,X as W,a3 as X,S as j,ag as Z,aM as $}from"./index-ZgiumcwN.js";const V=({isOpen:p,onClose:i,mode:r})=>{const{dashboardMarkdown:v,dashboardTitle:N,updateDashboardMarkdown:J,dashboardMindmaps:f,activeMindmapId:n,selectedModel:Y,deleteMindmap:q}=K(),[k,l]=s.useState(""),[S,m]=s.useState(""),[I,c]=s.useState(""),[g,o]=s.useState(r==="create"?"ai":"manual"),[A,M]=s.useState(""),[C,h]=s.useState(!1),[T,x]=s.useState(null);if(s.useEffect(()=>{if(p){if(r==="edit"){l(N||""),c(v||"");const t=f.find(u=>u.id===n);m((t==null?void 0:t.description)||""),o("manual")}else l(""),m(""),c(""),M(""),o("ai");x(null),h(!1)}},[p,v,N,r,f,n]),!p)return null;const D=t=>{t.preventDefault(),J(I||"",k||void 0,{createNew:r==="create",description:S}),i()},P=()=>{n&&window.confirm("Are you sure you want to delete this mindmap?")&&(q(n),i())},R=async()=>{var u,E,O;const t=A.trim();if(!t){x("Please enter an idea or topic for the mindmap.");return}h(!0),x(null);try{const d=[{role:"system",content:"You are an expert at structuring ideas as markdown mindmaps. Always respond with JSON only, no extra text."},{role:"user",content:`Create a markdown mindmap for this idea:

"${t}"

Requirements:
- Use a clear main heading for the central topic.
- Use nested lists and headings to show hierarchy.
- You may use markdown formatting like **bold**, *italic*, inline code, etc., as appropriate.
- Output rich but concise structure suitable for markmap.

Return JSON ONLY with this shape:
{ "title": "short title", "description": "optional description", "markdown": "# main heading..."}`}],F=await fetch("https://multi-model-worker.study-llm.me/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:Y,messages:d,stream:!1})});if(!F.ok)throw new Error("Failed to generate mindmap");let b=((O=(E=(u=(await F.json()).choices)==null?void 0:u[0])==null?void 0:E.message)==null?void 0:O.content)||"";b=b.replace(/```json/gi,"").replace(/```/g,"").trim();let a;try{a=JSON.parse(b)}catch{throw new Error("Invalid AI response format")}const y=typeof a.markdown=="string"?a.markdown:"";let w=typeof a.title=="string"?a.title.trim():"";const U=typeof a.description=="string"?a.description.trim():"";if(!w&&y){const L=y.split(`
`);for(const z of L){const G=z.trim();if(G.startsWith("#")){w=G.replace(/^#+\s*/,"");break}}}l(w||"Mindmap"),m(U),c(y),o("manual")}catch(d){x((d==null?void 0:d.message)||"Failed to generate mindmap. Please try again.")}finally{h(!1)}};return e.jsx("div",{className:"fixed inset-0 z-[70] overflow-y-auto","aria-labelledby":"mindmap-modal-title",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 transition-opacity","aria-hidden":"true",onClick:i,children:e.jsx("div",{className:"absolute inset-0 bg-gray-500 opacity-75"})}),e.jsx("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true",children:"â€‹"}),e.jsxs("div",{className:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-3xl sm:w-full",children:[e.jsxs("div",{className:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-1 flex h-10 w-10 items-center justify-center rounded-full bg-gradient-to-br from-indigo-500 to-purple-500 text-white shadow-md",children:e.jsx(Q,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg leading-6 font-semibold text-gray-900",id:"mindmap-modal-title",children:"Mindmap ideas"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Add a title and markdown content for your mindmap."})]})]}),e.jsx("button",{onClick:i,className:"ml-4 rounded-full p-1.5 text-gray-400 hover:bg-gray-100 hover:text-gray-600 transition",children:e.jsx(W,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"mb-4 flex items-start gap-2 rounded-md border border-indigo-50 bg-indigo-50/80 px-3 py-2 text-xs text-indigo-800",children:[e.jsx(X,{className:"mt-0.5 h-4 w-4 flex-shrink-0 text-indigo-500"}),e.jsx("p",{children:"Use AI to draft your mindmap quickly, or switch to manual to fine-tune the markdown."})]}),e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"inline-flex rounded-md bg-gray-100 p-1",children:[e.jsxs("button",{type:"button",onClick:()=>o("ai"),className:g==="ai"?"inline-flex items-center px-3 py-1.5 text-xs font-medium rounded bg-indigo-50 text-indigo-700 shadow-sm":"inline-flex items-center px-3 py-1.5 text-xs font-medium rounded text-gray-600 hover:text-gray-800 hover:bg-white/60",children:[e.jsx(j,{className:"w-3 h-3 mr-1.5"}),"AI Assist"]}),e.jsxs("button",{type:"button",onClick:()=>o("manual"),className:g==="manual"?"inline-flex items-center px-3 py-1.5 text-xs font-medium rounded bg-amber-50 text-amber-800 shadow-sm":"inline-flex items-center px-3 py-1.5 text-xs font-medium rounded text-gray-600 hover:text-gray-800 hover:bg-white/60",children:[e.jsx(Z,{className:"w-3 h-3 mr-1.5"}),"Manual"]})]})}),g==="ai"?e.jsxs("div",{className:"space-y-3 rounded-lg border border-gray-100 bg-gray-50/60 p-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold tracking-wide text-gray-500 uppercase",children:"Idea for AI"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Describe the topic or problem. AI will decide structure and formatting for the mindmap."}),e.jsx("textarea",{rows:6,className:"mt-2 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 text-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",value:A,onChange:t=>M(t.target.value),placeholder:"e.g. Improving on-time delivery performance for our factory"})]}),T&&e.jsx("div",{className:"text-xs text-red-600",children:T}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"button",onClick:R,disabled:C,className:"inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md shadow-sm text-indigo-700 bg-indigo-50 hover:bg-indigo-100 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed",children:C?e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"w-3 h-3 mr-1.5 animate-pulse"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"w-3 h-3 mr-1.5"}),"Generate mindmap"]})})})]}):e.jsx("form",{onSubmit:D,className:"space-y-4",children:e.jsxs("div",{className:"space-y-3 rounded-lg border border-gray-100 bg-gray-50/60 p-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold tracking-wide text-gray-500 uppercase",children:"Title"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Short, descriptive name for this mindmap."}),e.jsx("input",{type:"text",className:"mt-2 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 text-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",value:k,onChange:t=>l(t.target.value),placeholder:"Quarterly performance review ideas"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold tracking-wide text-gray-500 uppercase",children:"Description"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Optional context or notes about this mindmap."}),e.jsx("textarea",{rows:3,className:"mt-2 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 text-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",value:S,onChange:t=>m(t.target.value),placeholder:"e.g. Ideas for quarterly performance review workshop"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold tracking-wide text-gray-500 uppercase",children:"Mindmap Text"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"This markdown text drives the nodes in the mindmap. You can refine it anytime."}),e.jsx("textarea",{rows:12,className:"mt-2 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 font-mono text-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",value:I,onChange:t=>c(t.target.value),placeholder:`# Main topic
- Key point
  - Sub point`})]})]})})]}),e.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:px-6 flex flex-col sm:flex-row justify-between items-center gap-3 sm:gap-0",children:[e.jsx("div",{className:"order-2 sm:order-1 w-full sm:w-auto",children:r==="edit"&&n&&f.length>0&&e.jsxs("button",{type:"button",className:"w-full sm:w-auto inline-flex justify-center items-center rounded-md border border-transparent px-4 py-2 text-red-600 hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:text-sm font-medium",onClick:P,children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"Delete"]})}),e.jsxs("div",{className:"order-1 sm:order-2 flex flex-col sm:flex-row-reverse w-full sm:w-auto",children:[e.jsx("button",{type:"submit",onClick:D,className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:ml-3 sm:w-auto sm:text-sm",children:r==="edit"?"Save Changes":"Create Mindmap"}),e.jsx("button",{type:"button",onClick:i,className:"mt-3 sm:mt-0 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:w-auto sm:text-sm",children:"Cancel"})]})]})]})]})})};export{V as MindmapModal};
