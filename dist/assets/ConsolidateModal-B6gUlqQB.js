import{c as z,r as S,ap as T,a1 as O,a2 as D,O as e,X as U,a$ as E,S as P,a9 as R,ar as Q}from"./index-DXJwJ3uS.js";import{D as W}from"./database-BUAa2FDO.js";/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=z("Merge",[["path",{d:"m8 6 4-4 4 4",key:"ybng9g"}],["path",{d:"M12 2v10.3a4 4 0 0 1-1.172 2.872L4 22",key:"1hyw0i"}],["path",{d:"m20 22-5-5",key:"1m27yz"}]]),G=({isOpen:L,onClose:h})=>{const[p,j]=S.useState(""),[u,v]=S.useState(!1),{user:g}=T(),{bowlers:N,a3Cases:C,reorderBowlers:M,reorderA3Cases:F}=O(),n=D();if(!L)return null;const A=(r,l)=>{const x=new Set(l.map(a=>a.id)),d=r.map((a,m)=>x.has(a.id)?m:-1).filter(a=>a!==-1),t=r.filter(a=>!x.has(a.id));if(d.length===0)return[...t,...l];const i=Math.min(...d),o=r.slice(0,i).filter(a=>!x.has(a.id)).length,c=[...t];return c.splice(o,0,...l),c},k=async r=>{r.preventDefault();const l=((g==null?void 0:g.role)||"").trim().toLowerCase();if(!(l==="admin"||l==="super admin")){n.error("Only administrators can perform this action.");return}if(!p.trim()){n.error("Please enter at least one tag.");return}const d=p.split(",").map(t=>t.trim()).filter(t=>t.length>0);if(d.length===0){n.error("Please enter valid tags.");return}v(!0);try{const t=await Q.consolidateBowlers(d);if(t.success){const i=t.bowlers||[],o=t.a3Cases||[],c=new Set(N.map(s=>s.id)),a=new Set(C.map(s=>s.id)),m=i.filter(s=>!c.has(s.id)).length,f=i.filter(s=>c.has(s.id)).length,b=o.filter(s=>!a.has(s.id)).length,w=o.filter(s=>a.has(s.id)).length,I=m+b,$=f+w;if(I>0||$>0){if(i.length>0){const y=A(N,i);M(y)}if(o.length>0){const y=A(C,o);F(y)}const s=[];m>0&&s.push(`${m} bowlers added`),f>0&&s.push(`${f} bowlers updated`),b>0&&s.push(`${b} A3s added`),w>0&&s.push(`${w} A3s updated`),n.success(`Successfully consolidated: ${s.join(", ")}.`)}else n.info("No new or updated items found with these tags.");h(),j("")}else n.error("Failed to consolidate items.")}catch(t){console.error("Consolidate error:",t),n.error("An error occurred during consolidation.")}finally{v(!1)}};return e.jsxs("div",{className:"fixed inset-0 z-[70] flex items-center justify-center p-4 sm:p-6","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true",children:[e.jsx("div",{className:"fixed inset-0 bg-slate-900/60 backdrop-blur-sm transition-opacity animate-in fade-in duration-300",onClick:h}),e.jsxs("div",{className:"relative w-full max-w-lg bg-white rounded-2xl shadow-2xl border border-slate-200 overflow-hidden flex flex-col animate-in fade-in scale-in-95 duration-500",children:[e.jsxs("div",{className:"px-6 py-5 border-b border-slate-100 flex items-center justify-between bg-white sticky top-0 z-10",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-2.5 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-xl shadow-sm border border-cyan-100/50",children:e.jsx(B,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900 leading-none",children:"Consolidate Workspace"}),e.jsxs("p",{className:"mt-1.5 text-xs font-medium text-slate-500 flex items-center gap-1.5",children:[e.jsx(W,{className:"w-3.5 h-3.5 text-cyan-500"}),"Merge and synchronize data sources"]})]})]}),e.jsx("button",{onClick:h,className:"p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-50 rounded-lg transition-all",children:e.jsx(U,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-6",children:e.jsxs("form",{onSubmit:k,className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start gap-3 rounded-xl border border-cyan-100 bg-cyan-50/40 px-4 py-3",children:[e.jsx("div",{className:"p-1 bg-white rounded-lg shadow-sm border border-cyan-50 mt-0.5",children:e.jsx(E,{className:"h-3.5 w-3.5 text-cyan-600"})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs font-bold text-cyan-900",children:"Smart Consolidation"}),e.jsx("p",{className:"text-[10px] text-cyan-700 leading-relaxed",children:"This process will fetch Bowlers and A3 Cases matching your tags and merge them into your current workspace, preserving your local modifications where possible."})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{htmlFor:"tags",className:"block text-xs font-bold text-slate-500 uppercase tracking-wider",children:"Filter Tags"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",id:"tags",value:p,onChange:r=>j(r.target.value),placeholder:"e.g. Technical, Urgent, Q1",className:"w-full bg-white border border-slate-200 rounded-xl shadow-sm py-2.5 px-3.5 focus:outline-none focus:ring-2 focus:ring-cyan-500/20 focus:border-cyan-500 transition-all text-sm font-medium placeholder:text-slate-300",autoFocus:!0}),e.jsx("div",{className:"absolute right-3 top-2.5 text-slate-300",children:e.jsx(P,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-[10px] text-slate-400 font-medium ml-1",children:"Use comma-separated tags to filter the dataset."})]})]})}),e.jsxs("div",{className:"px-6 py-5 bg-slate-50 border-t border-slate-100 flex items-center justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:h,disabled:u,className:"px-5 py-2.5 text-sm font-bold text-slate-600 hover:text-slate-800 hover:bg-white rounded-xl transition-all active:scale-95 disabled:opacity-50 disabled:pointer-events-none",children:"Cancel"}),e.jsx("button",{type:"button",onClick:k,disabled:u,className:"px-6 py-2.5 bg-cyan-600 text-white text-sm font-bold rounded-xl shadow-lg shadow-cyan-200 hover:bg-cyan-700 hover:shadow-cyan-300 transition-all active:scale-95 flex items-center gap-2 disabled:opacity-70 disabled:pointer-events-none",children:u?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{children:"Consolidating..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"w-4 h-4"}),e.jsx("span",{children:"Consolidate"})]})})]})]})]})};export{G as ConsolidateModal};
