import{r as S,ai as T,Y as E,Z as F,O as s,X as M,a3 as z,aj as P}from"./index-86Xrcbdf.js";const U=({isOpen:B,onClose:f})=>{const[g,j]=S.useState(""),[h,A]=S.useState(!1),{user:p}=T(),{bowlers:C,a3Cases:N,reorderBowlers:I,reorderA3Cases:$}=E(),o=F();if(!B)return null;const v=(a,n)=>{const m=new Set(n.map(r=>r.id)),l=a.map((r,u)=>m.has(r.id)?u:-1).filter(r=>r!==-1),t=a.filter(r=>!m.has(r.id));if(l.length===0)return[...t,...n];const i=Math.min(...l),d=a.slice(0,i).filter(r=>!m.has(r.id)).length,c=[...t];return c.splice(d,0,...n),c},k=async a=>{a.preventDefault();const n=((p==null?void 0:p.role)||"").trim().toLowerCase();if(!(n==="admin"||n==="super admin")){o.error("Only administrators can perform this action.");return}if(!g.trim()){o.error("Please enter at least one tag.");return}const l=g.split(",").map(t=>t.trim()).filter(t=>t.length>0);if(l.length===0){o.error("Please enter valid tags.");return}A(!0);try{const t=await P.consolidateBowlers(l);if(t.success){const i=t.bowlers||[],d=t.a3Cases||[],c=new Set(C.map(e=>e.id)),r=new Set(N.map(e=>e.id)),u=i.filter(e=>!c.has(e.id)).length,x=i.filter(e=>c.has(e.id)).length,b=d.filter(e=>!r.has(e.id)).length,w=d.filter(e=>r.has(e.id)).length,L=u+b,O=x+w;if(L>0||O>0){if(i.length>0){const y=v(C,i);I(y)}if(d.length>0){const y=v(N,d);$(y)}const e=[];u>0&&e.push(`${u} bowlers added`),x>0&&e.push(`${x} bowlers updated`),b>0&&e.push(`${b} A3s added`),w>0&&e.push(`${w} A3s updated`),o.success(`Successfully consolidated: ${e.join(", ")}.`)}else o.info("No new or updated items found with these tags.");f(),j("")}else o.error("Failed to consolidate items.")}catch(t){console.error("Consolidate error:",t),o.error("An error occurred during consolidation.")}finally{A(!1)}};return s.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center bg-black bg-opacity-50",children:s.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md mx-4",children:[s.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-gray-200",children:[s.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Consolidate Bowlers"}),s.jsx("button",{onClick:f,className:"text-gray-400 hover:text-gray-500 transition-colors",children:s.jsx(M,{className:"w-5 h-5"})})]}),s.jsxs("form",{onSubmit:k,className:"p-4",children:[s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{htmlFor:"tags",className:"block text-sm font-medium text-gray-700 mb-1",children:"Tag (comma separated)"}),s.jsx("input",{type:"text",id:"tags",value:g,onChange:a=>j(a.target.value),placeholder:"e.g. Technical, Urgent, Q1",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",autoFocus:!0}),s.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Enter tags to filter and consolidate bowlers and A3 cases from the database."})]}),s.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[s.jsx("button",{type:"button",onClick:f,className:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",disabled:h,children:"Cancel"}),s.jsxs("button",{type:"submit",disabled:h,className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 flex items-center",children:[h&&s.jsx(z,{className:"w-4 h-4 mr-2 animate-spin"}),"Consolidate"]})]})]})]})})};export{U as ConsolidateModal};
