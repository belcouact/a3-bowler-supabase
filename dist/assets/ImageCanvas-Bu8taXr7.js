import{r as a,aa as L,O as s,ap as V,X as q}from"./index-CVcs9xOb.js";const J=({images:d,onImagesChange:p,height:z,onHeightChange:Y,label:P="Evidence Canvas (Paste or Upload Images)",leftControls:X})=>{const[h,w]=a.useState(null),[m,R]=a.useState(!1),[M,N]=a.useState(!1),[k,D]=a.useState(!1),c=a.useRef({x:0,y:0}),C=a.useRef({w:0,h:0,x:0,y:0}),v=a.useRef(null),j=a.useRef({h:0,y:0}),F=a.useRef(null),I=a.useRef(d);a.useEffect(()=>{I.current=d},[d]);const g=a.useCallback(e=>{var o;const t=(o=e.clipboardData)==null?void 0:o.items;if(t){for(let n=0;n<t.length;n++)if(t[n].type.indexOf("image")!==-1){const l=t[n].getAsFile();if(l){const r=new FileReader;r.onload=f=>{var u;const x=(u=f.target)==null?void 0:u.result,b={id:L(),src:x,x:50,y:50,width:200,height:200},y=[...I.current,b];p(y)},r.readAsDataURL(l)}}}},[p]);a.useEffect(()=>(document.addEventListener("paste",g),()=>{document.removeEventListener("paste",g)}),[g]);const A=e=>{var o;const t=(o=e.target.files)==null?void 0:o[0];if(t){const n=new FileReader;n.onload=l=>{var b;const r=(b=l.target)==null?void 0:b.result,f={id:L(),src:r,x:50,y:50,width:200,height:200},x=[...d,f];p(x)},n.readAsDataURL(t)}},H=(e,t)=>{e.stopPropagation(),w(t),R(!0),c.current={x:e.clientX,y:e.clientY}},i=(e,t,o)=>{e.stopPropagation(),w(t),N(!0),v.current=o,c.current={x:e.clientX,y:e.clientY};const n=d.find(l=>l.id===t);n&&(C.current={w:n.width,h:n.height,x:n.x,y:n.y})},W=e=>{e.stopPropagation(),e.preventDefault(),D(!0),j.current={h:z,y:e.clientY},document.addEventListener("mousemove",E),document.addEventListener("mouseup",S)},E=e=>{const t=e.clientY-j.current.y;Y(Math.max(200,j.current.h+t))},S=()=>{D(!1),document.removeEventListener("mousemove",E),document.removeEventListener("mouseup",S)},G=e=>{if(!k&&h){if(m){const t=e.clientX-c.current.x,o=e.clientY-c.current.y,n=d.map(l=>l.id===h?{...l,x:l.x+t,y:l.y+o}:l);p(n),c.current={x:e.clientX,y:e.clientY}}else if(M&&v.current){const t=e.clientX-c.current.x,o=e.clientY-c.current.y,n=v.current,l=d.map(r=>{if(r.id===h){let f=r.width,x=r.height,b=r.x,y=r.y;if(n.includes("r")&&(f=Math.max(50,r.width+t)),n.includes("l")){const u=r.width-t;u>50&&(f=u,b=r.x+t)}if(n.includes("b")&&(x=Math.max(50,r.height+o)),n.includes("t")){const u=r.height-o;u>50&&(x=u,y=r.y+o)}return{...r,width:f,height:x,x:b,y}}return r});p(l),c.current={x:e.clientX,y:e.clientY}}}},U=()=>{(m||M)&&(R(!1),N(!1),v.current=null)},O=e=>{const t=d.filter(o=>o.id!==e);p(t),w(null)};return s.jsxs("div",{className:"mb-6",onMouseMove:G,onMouseUp:U,onMouseLeave:U,children:[s.jsxs("div",{className:"flex justify-between items-center mb-2",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700",children:P}),s.jsxs("div",{className:"flex space-x-2",children:[X,s.jsxs("label",{className:"cursor-pointer inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50",children:[s.jsx(V,{className:"h-4 w-4 mr-0 sm:mr-1"}),s.jsx("span",{className:"hidden sm:inline",children:"Upload Image"}),s.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:A})]})]})]}),s.jsxs("div",{ref:F,className:"w-full bg-white border-2 border-dashed border-gray-300 rounded-lg relative overflow-hidden select-none",style:{height:z},onClick:()=>w(null),children:[s.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-4 bg-gray-100 hover:bg-gray-200 cursor-s-resize flex items-center justify-center border-t border-gray-200 z-50",onMouseDown:W,children:s.jsx("div",{className:"w-10 h-1 bg-gray-400 rounded-full"})}),d.length===0&&s.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-gray-400 pointer-events-none",children:s.jsx("p",{children:"Paste (Ctrl+V) images here or click Upload"})}),d.map(e=>s.jsxs("div",{style:{position:"absolute",left:e.x,top:e.y,width:e.width,height:e.height,cursor:m&&h===e.id?"grabbing":"grab",border:h===e.id?"2px solid #3b82f6":"1px solid transparent",zIndex:h===e.id?10:1},onMouseDown:t=>H(t,e.id),onClick:t=>t.stopPropagation(),children:[s.jsx("img",{src:e.src,alt:"evidence",className:"w-full h-full object-contain pointer-events-none"}),h===e.id&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"absolute -top-1.5 -left-1.5 w-3 h-3 bg-blue-500 rounded-full cursor-nw-resize z-20",onMouseDown:t=>i(t,e.id,"tl")}),s.jsx("div",{className:"absolute -top-1.5 -right-1.5 w-3 h-3 bg-blue-500 rounded-full cursor-ne-resize z-20",onMouseDown:t=>i(t,e.id,"tr")}),s.jsx("div",{className:"absolute -bottom-1.5 -left-1.5 w-3 h-3 bg-blue-500 rounded-full cursor-sw-resize z-20",onMouseDown:t=>i(t,e.id,"bl")}),s.jsx("div",{className:"absolute -bottom-1.5 -right-1.5 w-3 h-3 bg-blue-500 rounded-full cursor-se-resize z-20",onMouseDown:t=>i(t,e.id,"br")}),s.jsx("div",{className:"absolute -top-1.5 left-1/2 -translate-x-1/2 w-3 h-3 bg-blue-500 rounded-full cursor-n-resize z-20",onMouseDown:t=>i(t,e.id,"t")}),s.jsx("div",{className:"absolute -bottom-1.5 left-1/2 -translate-x-1/2 w-3 h-3 bg-blue-500 rounded-full cursor-s-resize z-20",onMouseDown:t=>i(t,e.id,"b")}),s.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 -left-1.5 w-3 h-3 bg-blue-500 rounded-full cursor-w-resize z-20",onMouseDown:t=>i(t,e.id,"l")}),s.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 -right-1.5 w-3 h-3 bg-blue-500 rounded-full cursor-e-resize z-20",onMouseDown:t=>i(t,e.id,"r")}),s.jsx("button",{className:"absolute -top-3 -right-3 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 shadow-md z-30",onClick:t=>{t.stopPropagation(),O(e.id)},title:"Remove Image",children:s.jsx(q,{className:"w-3 h-3"})})]})]},e.id))]})]})};export{J as I};
