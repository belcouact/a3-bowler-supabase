import{a1 as K,r as t,O as e,S as V,X,Z,Y as F,am as H,a9 as J,aY as U}from"./index-BmmYfibn.js";import{M as G}from"./MarkdownRenderer-zLNMrDjJ.js";import{B as g}from"./bot-B_Gt6eUO.js";import{D as O}from"./database-Ch4RShBh.js";import{S as Q}from"./send-cCbXADQq.js";const re=({isOpen:i,onClose:j,initialPrompt:c})=>{const{bowlers:R,a3Cases:W,selectedModel:D}=K(),[n,l]=t.useState([]),[m,v]=t.useState(""),[o,y]=t.useState(!1),x=t.useRef(null),h=t.useRef(!1),[L,$]=t.useState(600),[u,N]=t.useState(!1),B=t.useRef(null);t.useEffect(()=>{x.current&&x.current.scrollIntoView({behavior:"smooth"})},[n]);const T=s=>{N(!0),s.preventDefault()};t.useEffect(()=>{const s=()=>N(!1),a=f=>{if(u){const r=window.innerWidth-f.clientX;r>400&&r<window.innerWidth-50&&$(r)}};return u&&(window.addEventListener("mousemove",a),window.addEventListener("mouseup",s)),()=>{window.removeEventListener("mousemove",a),window.removeEventListener("mouseup",s)}},[u]);const d=async s=>{var r,k,S,I,z,C;if(!s.trim()||o)return;const a={role:"user",content:s},f=[...n,a];l(f),v(""),y(!0);try{const p={role:"system",content:`You are an AI assistant for the Metric Bowler & A3 Problem Solving application. 
        Here is the current data in the application: ${U(R,W)}.
        Answer the user's questions based on this data. Be concise and helpful.
        When a question involves a specific metric, look for any A3 cases whose linkedMetricIds include that metric's id.
        If there are completed A3 cases linked to the metric, briefly comment on whether performance appears to have improved since those A3s were closed and suggest the next step (for example: sustain, follow-up A3, or additional countermeasures).`},Y=n.filter(w=>w.role!=="system"),P=[p,...Y,a],b=await fetch("https://multi-model-worker.study-llm.me/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:D,messages:P,stream:!1})});if(!b.ok)throw new Error(`API Error: ${b.statusText}`);const M=await b.json(),q=((S=(k=(r=M.choices)==null?void 0:r[0])==null?void 0:k.message)==null?void 0:S.content)||((C=(z=(I=M.choices)==null?void 0:I[0])==null?void 0:z.delta)==null?void 0:C.content)||"Sorry, I couldn't generate a response.";l(w=>[...w,{role:"assistant",content:q}])}catch(E){console.error("AI Chat Error:",E),l(p=>[...p,{role:"assistant",content:"Sorry, there was an error communicating with the AI. Please try again later."}])}finally{y(!1)}},A=()=>d(m);return t.useEffect(()=>{i&&c&&!h.current&&(d(c),h.current=!0),i||(h.current=!1,l([]))},[i,c]),i?e.jsx("div",{className:"fixed inset-0 z-[70] overflow-hidden","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"absolute inset-0 overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-slate-900/50 backdrop-blur-sm transition-opacity",onClick:j}),e.jsx("div",{className:"pointer-events-none fixed inset-y-0 right-0 flex max-w-full pl-10",children:e.jsxs("div",{ref:B,className:"pointer-events-auto relative h-full transform transition-none ease-in-out bg-white shadow-2xl flex flex-col",style:{width:`${L}px`},children:[e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1.5 cursor-ew-resize hover:bg-brand-400/50 transition-colors z-50 flex items-center justify-center group",onMouseDown:T,children:e.jsx("div",{className:"h-8 w-1 bg-slate-300 rounded-full group-hover:bg-brand-400 transition-colors"})}),e.jsxs("div",{className:"flex h-full flex-col overflow-hidden bg-white",children:[e.jsx("div",{className:"bg-gradient-to-r from-brand-600 to-accent-600 px-6 py-5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-lg backdrop-blur-sm border border-white/10",children:e.jsx(V,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-white tracking-tight",id:"modal-title",children:"AI Coach"}),e.jsx("p",{className:"text-xs text-brand-50 font-medium opacity-90",children:"Analyzing your Bowler metrics & A3 cases"})]})]}),e.jsxs("button",{type:"button",className:"rounded-lg p-2 text-white/70 hover:text-white hover:bg-white/10 transition-all focus:outline-none focus:ring-2 focus:ring-white/50",onClick:j,children:[e.jsx("span",{className:"sr-only",children:"Close panel"}),e.jsx(X,{className:"h-5 w-5"})]})]})}),e.jsxs("div",{className:"flex-1 flex flex-col p-6 overflow-y-auto bg-slate-50 scroll-smooth custom-scrollbar",children:[n.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center p-8 opacity-0 animate-in fade-in slide-in-from-bottom-4 duration-700 fill-mode-forwards max-w-2xl mx-auto",children:[e.jsx("div",{className:"w-16 h-16 bg-white rounded-2xl shadow-lg shadow-brand-100 flex items-center justify-center mb-6 ring-1 ring-slate-100",children:e.jsx(g,{className:"w-8 h-8 text-brand-500"})}),e.jsx("h3",{className:"text-xl font-bold text-slate-800 mb-6",children:"AI Coach Assistant"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 w-full mb-8 text-left",children:[e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-slate-100 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("h4",{className:"font-semibold text-slate-700 mb-2 flex items-center gap-2 text-sm",children:[e.jsx(O,{className:"w-4 h-4 text-blue-500"})," What it knows"]}),e.jsxs("ul",{className:"text-xs text-slate-500 space-y-2 list-disc pl-4 leading-relaxed",children:[e.jsx("li",{children:"Your Bowler metrics and performance trends"}),e.jsx("li",{children:"Details of your A3 problem-solving cases"}),e.jsx("li",{children:"Linked relationships between metrics and cases"})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-slate-100 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("h4",{className:"font-semibold text-slate-700 mb-2 flex items-center gap-2 text-sm",children:[e.jsx(Z,{className:"w-4 h-4 text-amber-500"})," What it can do"]}),e.jsxs("ul",{className:"text-xs text-slate-500 space-y-2 list-disc pl-4 leading-relaxed",children:[e.jsx("li",{children:"Analyze performance trends and outliers"}),e.jsx("li",{children:"Summarize A3 cases and their status"}),e.jsx("li",{children:"Suggest countermeasures for failing metrics"}),e.jsx("li",{children:"Draft A3 content based on metric data"})]})]})]}),e.jsx("p",{className:"text-sm text-slate-400 font-medium mb-3",children:"Try asking..."}),e.jsxs("div",{className:"grid grid-cols-1 gap-2 w-full max-w-xs",children:[e.jsxs("button",{onClick:()=>d("What are my top failing metrics?"),className:"text-xs text-left px-4 py-3 bg-white hover:bg-brand-50 hover:text-brand-700 text-slate-600 rounded-xl border border-slate-200 hover:border-brand-200 transition-all shadow-sm group flex items-center justify-between",children:[e.jsx("span",{children:"What are my top failing metrics?"}),e.jsx(F,{className:"w-3 h-3 opacity-0 group-hover:opacity-100 transition-opacity"})]}),e.jsxs("button",{onClick:()=>d("Summarize my open A3 cases"),className:"text-xs text-left px-4 py-3 bg-white hover:bg-brand-50 hover:text-brand-700 text-slate-600 rounded-xl border border-slate-200 hover:border-brand-200 transition-all shadow-sm group flex items-center justify-between",children:[e.jsx("span",{children:"Summarize my open A3 cases"}),e.jsx(H,{className:"w-3 h-3 opacity-0 group-hover:opacity-100 transition-opacity"})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[n.map((s,a)=>e.jsx("div",{className:`flex w-full ${s.role==="user"?"justify-end":"justify-start"} animate-in fade-in slide-in-from-bottom-2 duration-300`,children:e.jsxs("div",{className:`flex max-w-[85%] ${s.role==="user"?"flex-row-reverse":"flex-row"} gap-3`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${s.role==="user"?"bg-brand-100 text-brand-600":"bg-accent-100 text-accent-600"}`,children:s.role==="user"?e.jsx("div",{className:"text-xs font-bold",children:"You"}):e.jsx(g,{className:"w-4 h-4"})}),e.jsx("div",{className:`rounded-2xl px-5 py-4 shadow-sm text-sm leading-relaxed ${s.role==="user"?"bg-brand-600 text-white rounded-tr-none":"bg-white text-slate-700 border border-slate-100 rounded-tl-none shadow-slate-100"}`,children:s.role==="user"?e.jsx("div",{className:"whitespace-pre-wrap",children:s.content}):e.jsx("div",{className:"prose prose-sm prose-slate max-w-none prose-p:my-1 prose-headings:text-slate-800 prose-headings:font-bold prose-strong:text-slate-800 prose-ul:my-2 prose-li:my-0.5",children:e.jsx(G,{content:s.content})})})]})},a)),o&&e.jsx("div",{className:"flex justify-start w-full animate-in fade-in slide-in-from-bottom-2",children:e.jsxs("div",{className:"flex max-w-[85%] flex-row gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-accent-100 text-accent-600 flex items-center justify-center flex-shrink-0",children:e.jsx(g,{className:"w-4 h-4"})}),e.jsxs("div",{className:"bg-white border border-slate-100 rounded-2xl rounded-tl-none px-5 py-4 shadow-sm flex items-center gap-3",children:[e.jsx(J,{className:"w-4 h-4 animate-spin text-accent-500"}),e.jsx("span",{className:"text-sm font-medium text-slate-500",children:"Analyzing data..."})]})]})}),e.jsx("div",{ref:x,className:"h-4"})]})]}),e.jsxs("div",{className:"p-4 bg-white border-t border-slate-100",children:[e.jsxs("div",{className:"relative flex items-end gap-2 bg-slate-50 p-2 rounded-2xl border border-slate-200 focus-within:border-brand-300 focus-within:ring-4 focus-within:ring-brand-50 transition-all",children:[e.jsx("textarea",{className:"flex-1 bg-transparent border-0 focus:ring-0 text-slate-800 placeholder:text-slate-400 text-sm resize-none py-2.5 px-3 max-h-32 min-h-[44px]",placeholder:"Ask a question about your metrics...",rows:1,value:m,onChange:s=>v(s.target.value),onKeyDown:s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),A())},disabled:o}),e.jsx("button",{onClick:A,disabled:o||!m.trim(),className:"mb-1 mr-1 p-2 rounded-xl bg-brand-600 text-white hover:bg-brand-700 disabled:bg-slate-200 disabled:text-slate-400 transition-all shadow-sm active:scale-95 flex items-center justify-center",children:e.jsx(Q,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-[10px] text-center text-slate-400 mt-3 font-medium",children:"AI can make mistakes. Verify important information."})]})]})]})})]})}):null};export{re as AIChatModal};
