import{c as N,W as I,Z as H,al as C,r as i,O as a,a6 as A,X as R,am as g}from"./index-CQJl7MZx.js";import{I as k}from"./ImageCanvas-BQxDvfyv.js";/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=N("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]),D=()=>{const{id:f}=I(),{a3Cases:p,updateA3Case:n,isLoading:v}=H(),{user:t}=C(),e=p.find(s=>s.id===f),r=i.useRef(null),[h,d]=i.useState([]),[x,c]=i.useState(500),b=async s=>!e||!(t!=null&&t.username)?URL.createObjectURL(s):(await g.uploadA3Image(t.username,e.id,s)).url;i.useEffect(()=>{if(e){e.resultImages&&JSON.stringify(e.resultImages)!==JSON.stringify(h)&&d(e.resultImages||[]),e.resultCanvasHeight&&e.resultCanvasHeight!==x&&c(e.resultCanvasHeight);const s=e.results||"";r.current&&r.current.value!==s&&(r.current.value=s)}},[e==null?void 0:e.id]),i.useEffect(()=>{if(!e||!(t!=null&&t.username)||Array.isArray(e.resultImages)&&e.resultImages.length>0)return;let o=!1;return(async()=>{try{const l=await g.loadA3Detail(t.username,e.id);if(!l||!l.success||o)return;const u={...e};let m=!1;Array.isArray(l.resultImages)&&(d(l.resultImages),u.resultImages=l.resultImages,m=!0),typeof l.resultCanvasHeight=="number"&&(c(l.resultCanvasHeight),u.resultCanvasHeight=l.resultCanvasHeight,m=!0),m&&n(u)}catch{}})(),()=>{o=!0}},[e==null?void 0:e.id,t==null?void 0:t.username,n]);const y=s=>{d(s),e&&n({...e,resultImages:s})},j=s=>{c(s),e&&n({...e,resultCanvasHeight:s})},w=()=>{if(e&&r.current){const s=r.current.value;s!==e.results&&n({...e,results:s})}};return v?a.jsx("div",{className:"flex items-center justify-center py-24",children:a.jsxs("div",{className:"flex flex-col items-center",children:[a.jsx(A,{className:"w-10 h-10 animate-spin text-brand-600"}),a.jsx("p",{className:"mt-4 text-slate-500 font-medium animate-pulse",children:"Loading results data..."})]})}):e?a.jsxs("div",{className:"max-w-7xl mx-auto space-y-12 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"p-2 bg-brand-50 rounded-lg text-brand-600",children:a.jsx(L,{className:"w-6 h-6"})}),a.jsx("h2",{className:"text-2xl font-bold text-slate-900 font-display",children:"Results & Follow-up"})]}),a.jsx("p",{className:"text-slate-500 text-lg leading-relaxed max-w-2xl",children:"Document the tangible outcomes and evidence achieved after implementing your action plan."})]}),a.jsxs("div",{className:"grid grid-cols-1 gap-8",children:[a.jsx("div",{className:"bg-white rounded-2xl border border-slate-200/60 shadow-sm overflow-hidden p-1 bg-slate-50/30",children:a.jsx(k,{images:h,onImagesChange:y,height:x,onHeightChange:j,label:"Result Evidence (Paste or Upload Images)",onUploadImage:b})}),a.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden transition-all duration-300 focus-within:ring-4 focus-within:ring-brand-50 focus-within:border-brand-300",children:[a.jsx("div",{className:"px-6 py-4 border-b border-slate-100 bg-slate-50/50",children:a.jsx("label",{htmlFor:"results",className:"text-sm font-bold text-slate-700 uppercase tracking-wider",children:"Actual Results & Key Learnings"})}),a.jsx("textarea",{ref:r,id:"results",rows:8,className:"w-full px-6 py-6 text-slate-700 placeholder-slate-400 border-none focus:ring-0 resize-none text-lg leading-relaxed font-medium",placeholder:"Describe what happened after actions were taken. What did you learn? Was the target met?",defaultValue:e.results||"",onBlur:w}),a.jsx("div",{className:"px-6 py-4 bg-slate-50/50 border-t border-slate-100 flex justify-between items-center",children:a.jsx("span",{className:"text-xs text-slate-400 font-medium",children:"Changes are saved automatically on blur"})})]})]})]}):a.jsx("div",{className:"flex items-center justify-center py-24 text-center",children:a.jsxs("div",{className:"max-w-md space-y-4",children:[a.jsx("div",{className:"w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mx-auto text-slate-400",children:a.jsx(R,{className:"w-8 h-8"})}),a.jsx("h3",{className:"text-xl font-bold text-slate-900",children:"A3 Case Not Found"}),a.jsx("p",{className:"text-slate-500",children:"It may have been deleted or the link is invalid."})]})})};export{D as default};
