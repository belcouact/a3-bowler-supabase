import{e as z,r as s,j as e,G as B,X as K,I as L,S as y,F as Q}from"./index-D1cbOZCM.js";const $=({isOpen:u,onClose:o,mode:i})=>{const{dashboardMarkdown:w,dashboardTitle:j,updateDashboardMarkdown:J,dashboardMindmaps:v,activeMindmapId:N,selectedModel:Y}=z(),[k,d]=s.useState(""),[S,l]=s.useState(""),[I,c]=s.useState(""),[p,r]=s.useState(i==="create"?"ai":"manual"),[A,C]=s.useState(""),[M,h]=s.useState(!1),[T,m]=s.useState(null);if(s.useEffect(()=>{if(u){if(i==="edit"){d(j||""),c(w||"");const t=v.find(x=>x.id===N);l((t==null?void 0:t.description)||""),r("manual")}else d(""),l(""),c(""),C(""),r("ai");m(null),h(!1)}},[u,w,j,i,v,N]),!u)return null;const E=t=>{t.preventDefault(),J(I||"",k||void 0,{createNew:i==="create",description:S}),o()},q=async()=>{var x,D,F;const t=A.trim();if(!t){m("Please enter an idea or topic for the mindmap.");return}h(!0),m(null);try{const n=[{role:"system",content:"You are an expert at structuring ideas as markdown mindmaps. Always respond with JSON only, no extra text."},{role:"user",content:`Create a markdown mindmap for this idea:

"${t}"

Requirements:
- Use a clear main heading for the central topic.
- Use nested lists and headings to show hierarchy.
- You may use markdown formatting like **bold**, *italic*, inline code, etc., as appropriate.
- Output rich but concise structure suitable for markmap.

Return JSON ONLY with this shape:
{ "title": "short title", "description": "optional description", "markdown": "# main heading..."}`}],G=await fetch("https://multi-model-worker.study-llm.me/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:Y,messages:n,stream:!1})});if(!G.ok)throw new Error("Failed to generate mindmap");let g=((F=(D=(x=(await G.json()).choices)==null?void 0:x[0])==null?void 0:D.message)==null?void 0:F.content)||"";g=g.replace(/```json/gi,"").replace(/```/g,"").trim();let a;try{a=JSON.parse(g)}catch{throw new Error("Invalid AI response format")}const f=typeof a.markdown=="string"?a.markdown:"";let b=typeof a.title=="string"?a.title.trim():"";const P=typeof a.description=="string"?a.description.trim():"";if(!b&&f){const R=f.split(`
`);for(const U of R){const O=U.trim();if(O.startsWith("#")){b=O.replace(/^#+\s*/,"");break}}}d(b||"Mindmap"),l(P),c(f),r("manual")}catch(n){m((n==null?void 0:n.message)||"Failed to generate mindmap. Please try again.")}finally{h(!1)}};return e.jsx("div",{className:"fixed inset-0 z-[70] overflow-y-auto","aria-labelledby":"mindmap-modal-title",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 transition-opacity","aria-hidden":"true",onClick:o,children:e.jsx("div",{className:"absolute inset-0 bg-gray-500 opacity-75"})}),e.jsx("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true",children:"â€‹"}),e.jsxs("div",{className:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-3xl sm:w-full",children:[e.jsxs("div",{className:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-1 flex h-10 w-10 items-center justify-center rounded-full bg-gradient-to-br from-indigo-500 to-purple-500 text-white shadow-md",children:e.jsx(B,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg leading-6 font-semibold text-gray-900",id:"mindmap-modal-title",children:"Mindmap ideas"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Add a title and markdown content for your mindmap."})]})]}),e.jsx("button",{onClick:o,className:"ml-4 rounded-full p-1.5 text-gray-400 hover:bg-gray-100 hover:text-gray-600 transition",children:e.jsx(K,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"mb-4 flex items-start gap-2 rounded-md border border-indigo-50 bg-indigo-50/80 px-3 py-2 text-xs text-indigo-800",children:[e.jsx(L,{className:"mt-0.5 h-4 w-4 flex-shrink-0 text-indigo-500"}),e.jsx("p",{children:"Use AI to draft your mindmap quickly, or switch to manual to fine-tune the markdown."})]}),e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"inline-flex rounded-md bg-gray-100 p-1",children:[e.jsxs("button",{type:"button",onClick:()=>r("ai"),className:p==="ai"?"inline-flex items-center px-3 py-1.5 text-xs font-medium rounded bg-white text-indigo-700 shadow-sm":"inline-flex items-center px-3 py-1.5 text-xs font-medium rounded text-gray-600 hover:text-gray-800 hover:bg-white/60",children:[e.jsx(y,{className:"w-3 h-3 mr-1.5"}),"AI Assist"]}),e.jsxs("button",{type:"button",onClick:()=>r("manual"),className:p==="manual"?"inline-flex items-center px-3 py-1.5 text-xs font-medium rounded bg-white text-gray-900 shadow-sm":"inline-flex items-center px-3 py-1.5 text-xs font-medium rounded text-gray-600 hover:text-gray-800 hover:bg-white/60",children:[e.jsx(Q,{className:"w-3 h-3 mr-1.5"}),"Manual"]})]})}),p==="ai"?e.jsxs("div",{className:"space-y-3 rounded-lg border border-gray-100 bg-gray-50/60 p-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold tracking-wide text-gray-500 uppercase",children:"Idea for AI"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Describe the topic or problem. AI will decide structure and formatting for the mindmap."}),e.jsx("textarea",{rows:6,className:"mt-2 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 text-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",value:A,onChange:t=>C(t.target.value),placeholder:"e.g. Improving on-time delivery performance for our factory"})]}),T&&e.jsx("div",{className:"text-xs text-red-600",children:T}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"button",onClick:q,disabled:M,className:"inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md shadow-sm text-indigo-700 bg-indigo-50 hover:bg-indigo-100 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed",children:M?e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"w-3 h-3 mr-1.5 animate-pulse"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"w-3 h-3 mr-1.5"}),"Generate mindmap"]})})})]}):e.jsx("form",{onSubmit:E,className:"space-y-4",children:e.jsxs("div",{className:"space-y-3 rounded-lg border border-gray-100 bg-gray-50/60 p-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold tracking-wide text-gray-500 uppercase",children:"Title"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Short, descriptive name for this mindmap."}),e.jsx("input",{type:"text",className:"mt-2 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 text-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",value:k,onChange:t=>d(t.target.value),placeholder:"Quarterly performance review ideas"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold tracking-wide text-gray-500 uppercase",children:"Description"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Optional context or notes about this mindmap."}),e.jsx("textarea",{rows:3,className:"mt-2 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 text-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",value:S,onChange:t=>l(t.target.value),placeholder:"e.g. Ideas for quarterly performance review workshop"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold tracking-wide text-gray-500 uppercase",children:"Mindmap Text"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"This markdown text drives the nodes in the mindmap. You can refine it anytime."}),e.jsx("textarea",{rows:12,className:"mt-2 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 font-mono text-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500",value:I,onChange:t=>c(t.target.value),placeholder:`# Main topic
- Key point
  - Sub point`})]})]})})]}),e.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse",children:[e.jsx("button",{type:"submit",onClick:E,className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:ml-3 sm:w-auto sm:text-sm",children:i==="edit"?"Save Changes":"Create Mindmap"}),e.jsx("button",{type:"button",onClick:o,className:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:w-auto sm:text-sm",children:"Cancel"})]})]})]})})};export{$ as MindmapModal};
