import{a1 as U,r as i,O as e,Q as W,X as q,S as N,am as K,a7 as Q,aT as X}from"./index-9EAd4Y7y.js";const Z=({isOpen:f,onClose:r,mode:s})=>{const{dashboardMarkdown:k,dashboardTitle:M,updateDashboardMarkdown:z,dashboardMindmaps:h,activeMindmapId:o,selectedModel:J,deleteMindmap:R}=U(),[S,c]=i.useState(""),[A,m]=i.useState(""),[C,u]=i.useState(""),[a,l]=i.useState(s==="create"?"ai":"manual"),[g,I]=i.useState(""),[b,w]=i.useState(!1),[T,x]=i.useState(null);if(i.useEffect(()=>{if(f){if(s==="edit"){c(M||""),u(k||"");const t=h.find(p=>p.id===o);m((t==null?void 0:t.description)||""),l("manual")}else c(""),m(""),u(""),I(""),l("ai");x(null),w(!1)}},[f,k,M,s,h,o]),!f)return null;const E=t=>{t.preventDefault(),z(C||"",S||void 0,{createNew:s==="create",description:A}),r()},P=()=>{o&&window.confirm("Are you sure you want to delete this mindmap?")&&(R(o),r())},Y=async()=>{var p,D,O;const t=g.trim();if(!t){x("Please enter an idea or topic for the mindmap.");return}w(!0),x(null);try{const d=[{role:"system",content:"You are an expert at structuring ideas as markdown mindmaps. Always respond with JSON only, no extra text."},{role:"user",content:`Create a markdown mindmap for this idea:

"${t}"

Requirements:
- Use a clear main heading for the central topic.
- Use nested lists and headings to show hierarchy.
- You may use markdown formatting like **bold**, *italic*, inline code, etc., as appropriate.
- Output rich but concise structure suitable for markmap.

Return JSON ONLY with this shape:
{ "title": "short title", "description": "optional description", "markdown": "# main heading..."}`}],F=await fetch("https://multi-model-worker.study-llm.me/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:J,messages:d,stream:!1})});if(!F.ok)throw new Error("Failed to generate mindmap");let j=((O=(D=(p=(await F.json()).choices)==null?void 0:p[0])==null?void 0:D.message)==null?void 0:O.content)||"";j=j.replace(/```json/gi,"").replace(/```/g,"").trim();let n;try{n=JSON.parse(j)}catch{throw new Error("Invalid AI response format")}const y=typeof n.markdown=="string"?n.markdown:"";let v=typeof n.title=="string"?n.title.trim():"";const $=typeof n.description=="string"?n.description.trim():"";if(!v&&y){const B=y.split(`
`);for(const L of B){const G=L.trim();if(G.startsWith("#")){v=G.replace(/^#+\s*/,"");break}}}c(v||"Mindmap"),m($),u(y),l("manual")}catch(d){x((d==null?void 0:d.message)||"Failed to generate mindmap. Please try again.")}finally{w(!1)}};return e.jsx("div",{className:"fixed inset-0 z-[70] overflow-y-auto","aria-labelledby":"mindmap-modal-title",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 transition-opacity","aria-hidden":"true",onClick:r,children:e.jsx("div",{className:"absolute inset-0 bg-slate-900/40 backdrop-blur-sm transition-opacity"})}),e.jsx("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true",children:"â€‹"}),e.jsxs("div",{className:"inline-block align-bottom bg-white rounded-2xl text-left overflow-hidden shadow-2xl transform transition-all sm:my-8 sm:align-middle sm:max-w-3xl sm:w-full animate-in fade-in zoom-in-95 duration-200 border border-white/20 ring-1 ring-black/5",children:[e.jsx("div",{className:"bg-gradient-to-r from-indigo-600 to-purple-600 px-6 py-5",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-2.5 bg-white/20 rounded-xl backdrop-blur-sm border border-white/10 shadow-inner",children:e.jsx(W,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white tracking-tight",id:"mindmap-modal-title",children:s==="create"?"New Mindmap":"Edit Mindmap"}),e.jsx("p",{className:"text-indigo-100 text-xs font-medium opacity-90 mt-0.5",children:s==="create"?"Brainstorm ideas with AI assistance":"Refine your mindmap structure"})]})]}),e.jsx("button",{onClick:r,className:"rounded-full p-2 text-white/70 hover:bg-white/20 hover:text-white transition-colors",children:e.jsx(q,{className:"w-5 h-5"})})]})}),e.jsxs("div",{className:"bg-white px-6 py-6",children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsxs("div",{className:"inline-flex rounded-xl bg-slate-100 p-1.5 shadow-inner ring-1 ring-slate-200",children:[e.jsxs("button",{type:"button",onClick:()=>l("ai"),className:a==="ai"?"inline-flex items-center px-4 py-2 text-sm font-bold rounded-lg bg-white text-indigo-600 shadow-sm ring-1 ring-black/5 transition-all":"inline-flex items-center px-4 py-2 text-sm font-medium rounded-lg text-slate-500 hover:text-slate-700 hover:bg-slate-200/50 transition-all",children:[e.jsx(N,{className:`w-4 h-4 mr-2 ${a==="ai"?"text-indigo-500":"text-slate-400"}`}),"AI Assistant"]}),e.jsxs("button",{type:"button",onClick:()=>l("manual"),className:a==="manual"?"inline-flex items-center px-4 py-2 text-sm font-bold rounded-lg bg-white text-indigo-600 shadow-sm ring-1 ring-black/5 transition-all":"inline-flex items-center px-4 py-2 text-sm font-medium rounded-lg text-slate-500 hover:text-slate-700 hover:bg-slate-200/50 transition-all",children:[e.jsx(K,{className:`w-4 h-4 mr-2 ${a==="manual"?"text-indigo-500":"text-slate-400"}`}),"Manual Editor"]})]})}),a==="ai"?e.jsxs("div",{className:"space-y-4 animate-in fade-in slide-in-from-bottom-2 duration-300",children:[e.jsxs("div",{className:"bg-indigo-50/50 rounded-xl border border-indigo-100 p-4",children:[e.jsx("label",{className:"block text-xs font-bold tracking-wide text-indigo-900 uppercase mb-2",children:"What's on your mind?"}),e.jsx("p",{className:"text-sm text-slate-600 mb-3",children:"Describe your topic or problem. Our AI will structure it into a comprehensive mindmap for you."}),e.jsx("textarea",{rows:6,className:"block w-full border-slate-200 rounded-xl shadow-sm py-3 px-4 text-sm focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all resize-none",value:g,onChange:t=>I(t.target.value),placeholder:"e.g. Strategies for improving on-time delivery performance in our factory..."})]}),T&&e.jsxs("div",{className:"p-3 rounded-lg bg-red-50 border border-red-100 text-xs font-medium text-red-600 flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4"}),T]}),e.jsx("div",{className:"flex justify-end pt-2",children:e.jsx("button",{type:"button",onClick:Y,disabled:b||!g.trim(),className:"inline-flex items-center px-5 py-2.5 border border-transparent text-sm font-bold rounded-xl shadow-lg shadow-indigo-500/20 text-white bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all transform hover:scale-[1.02] active:scale-[0.98]",children:b?e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"w-4 h-4 mr-2 animate-spin"}),"Generating Ideas..."]}):e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"w-4 h-4 mr-2"}),"Generate Mindmap"]})})})]}):e.jsx("form",{onSubmit:E,className:"space-y-5 animate-in fade-in slide-in-from-bottom-2 duration-300",children:e.jsxs("div",{className:"grid grid-cols-1 gap-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold tracking-wide text-slate-500 uppercase mb-1.5",children:"Title"}),e.jsx("input",{type:"text",className:"block w-full border-slate-200 rounded-xl shadow-sm py-2.5 px-4 text-sm focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all font-medium",value:S,onChange:t=>c(t.target.value),placeholder:"Mindmap Title"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold tracking-wide text-slate-500 uppercase mb-1.5",children:"Description"}),e.jsx("textarea",{rows:2,className:"block w-full border-slate-200 rounded-xl shadow-sm py-2.5 px-4 text-sm focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all resize-none",value:A,onChange:t=>m(t.target.value),placeholder:"Brief description of this mindmap..."})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[e.jsx("label",{className:"block text-xs font-bold tracking-wide text-slate-500 uppercase",children:"Markdown Content"}),e.jsx("span",{className:"text-[10px] font-medium text-slate-400 bg-slate-100 px-2 py-0.5 rounded-full",children:"Markdown Supported"})]}),e.jsx("textarea",{rows:12,className:"block w-full border-slate-200 rounded-xl shadow-sm py-3 px-4 font-mono text-sm bg-slate-50 focus:bg-white focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all",value:C,onChange:t=>u(t.target.value),placeholder:`# Main topic
- Key point
  - Sub point`})]})]})})]}),e.jsxs("div",{className:"bg-slate-50 px-6 py-4 flex flex-col sm:flex-row justify-between items-center gap-3 border-t border-slate-100",children:[e.jsx("div",{className:"order-2 sm:order-1 w-full sm:w-auto",children:s==="edit"&&o&&h.length>0&&e.jsxs("button",{type:"button",className:"w-full sm:w-auto inline-flex justify-center items-center rounded-xl border border-transparent px-4 py-2.5 text-red-600 hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 text-sm font-bold transition-colors",onClick:P,children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"Delete Mindmap"]})}),e.jsxs("div",{className:"order-1 sm:order-2 flex flex-col sm:flex-row gap-3 w-full sm:w-auto",children:[e.jsx("button",{type:"button",onClick:r,className:"w-full sm:w-auto inline-flex justify-center rounded-xl border border-slate-200 shadow-sm px-5 py-2.5 bg-white text-sm font-bold text-slate-700 hover:bg-slate-50 hover:text-slate-900 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-all",children:"Cancel"}),(a==="manual"||a==="ai"&&!b)&&e.jsx("button",{type:"submit",onClick:E,className:"w-full sm:w-auto inline-flex justify-center rounded-xl border border-transparent shadow-lg shadow-indigo-500/20 px-6 py-2.5 bg-indigo-600 text-sm font-bold text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-all transform hover:scale-[1.02] active:scale-[0.98]",children:s==="edit"?"Save Changes":"Create Mindmap"})]})]})]})]})})};export{Z as MindmapModal};
