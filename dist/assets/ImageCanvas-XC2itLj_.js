import{r as a,ac as j,O as s,av as q,X as B}from"./index-BUcG817Z.js";const K=({images:c,onImagesChange:u,height:N,onHeightChange:X,label:k="Evidence Canvas (Paste or Upload Images)",leftControls:U,onUploadImage:p})=>{const[b,v]=a.useState(null),[z,D]=a.useState(!1),[E,S]=a.useState(!1),[F,L]=a.useState(!1),h=a.useRef({x:0,y:0}),C=a.useRef({w:0,h:0,x:0,y:0}),y=a.useRef(null),R=a.useRef({h:0,y:0}),A=a.useRef(null),g=a.useRef(c);a.useEffect(()=>{g.current=c},[c]);const M=a.useCallback(e=>{var l;const t=(l=e.clipboardData)==null?void 0:l.items;if(t){for(let n=0;n<t.length;n++)if(t[n].type.indexOf("image")!==-1){const o=t[n].getAsFile();if(o)if(p)(async()=>{const r=await p(o),d={id:j(),src:r,x:50,y:50,width:200,height:200},i=[...g.current,d];u(i)})();else{const r=new FileReader;r.onload=d=>{var x;const i=(x=d.target)==null?void 0:x.result,w={id:j(),src:i,x:50,y:50,width:200,height:200},m=[...g.current,w];u(m)},r.readAsDataURL(o)}}}},[u,p]);a.useEffect(()=>(document.addEventListener("paste",M),()=>{document.removeEventListener("paste",M)}),[M]);const H=e=>{var l;const t=(l=e.target.files)==null?void 0:l[0];if(t)if(p)(async()=>{const n=await p(t),o={id:j(),src:n,x:50,y:50,width:200,height:200},r=[...c,o];u(r)})();else{const n=new FileReader;n.onload=o=>{var w;const r=(w=o.target)==null?void 0:w.result,d={id:j(),src:r,x:50,y:50,width:200,height:200},i=[...c,d];u(i)},n.readAsDataURL(t)}},W=(e,t)=>{e.stopPropagation(),v(t),D(!0),h.current={x:e.clientX,y:e.clientY}},f=(e,t,l)=>{e.stopPropagation(),v(t),S(!0),y.current=l,h.current={x:e.clientX,y:e.clientY};const n=c.find(o=>o.id===t);n&&(C.current={w:n.width,h:n.height,x:n.x,y:n.y})},G=e=>{e.stopPropagation(),e.preventDefault(),L(!0),R.current={h:N,y:e.clientY},document.addEventListener("mousemove",Y),document.addEventListener("mouseup",I)},Y=e=>{const t=e.clientY-R.current.y;X(Math.max(200,R.current.h+t))},I=()=>{L(!1),document.removeEventListener("mousemove",Y),document.removeEventListener("mouseup",I)},O=e=>{if(!F&&b){if(z){const t=e.clientX-h.current.x,l=e.clientY-h.current.y,n=c.map(o=>o.id===b?{...o,x:o.x+t,y:o.y+l}:o);u(n),h.current={x:e.clientX,y:e.clientY}}else if(E&&y.current){const t=e.clientX-h.current.x,l=e.clientY-h.current.y,n=y.current,o=c.map(r=>{if(r.id===b){let d=r.width,i=r.height,w=r.x,m=r.y;if(n.includes("r")&&(d=Math.max(50,r.width+t)),n.includes("l")){const x=r.width-t;x>50&&(d=x,w=r.x+t)}if(n.includes("b")&&(i=Math.max(50,r.height+l)),n.includes("t")){const x=r.height-l;x>50&&(i=x,m=r.y+l)}return{...r,width:d,height:i,x:w,y:m}}return r});u(o),h.current={x:e.clientX,y:e.clientY}}}},P=()=>{(z||E)&&(D(!1),S(!1),y.current=null)},V=e=>{const t=c.filter(l=>l.id!==e);u(t),v(null)};return s.jsxs("div",{className:"mb-6",onMouseMove:O,onMouseUp:P,onMouseLeave:P,children:[s.jsxs("div",{className:"flex justify-between items-center mb-2",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700",children:k}),s.jsxs("div",{className:"flex space-x-2",children:[U,s.jsxs("label",{className:"cursor-pointer inline-flex items-center px-3 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50",children:[s.jsx(q,{className:"h-4 w-4 mr-0 sm:mr-1"}),s.jsx("span",{className:"hidden sm:inline",children:"Upload Image"}),s.jsx("input",{type:"file",className:"hidden",accept:"image/*",onChange:H})]})]})]}),s.jsxs("div",{ref:A,className:"w-full bg-white border-2 border-dashed border-gray-300 rounded-lg relative overflow-hidden select-none",style:{height:N},onClick:()=>v(null),children:[s.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-4 bg-gray-100 hover:bg-gray-200 cursor-s-resize flex items-center justify-center border-t border-gray-200 z-50",onMouseDown:G,children:s.jsx("div",{className:"w-10 h-1 bg-gray-400 rounded-full"})}),c.length===0&&s.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-gray-400 pointer-events-none",children:s.jsx("p",{children:"Paste (Ctrl+V) images here or click Upload"})}),c.map(e=>s.jsxs("div",{style:{position:"absolute",left:e.x,top:e.y,width:e.width,height:e.height,cursor:z&&b===e.id?"grabbing":"grab",border:b===e.id?"2px solid #3b82f6":"1px solid transparent",zIndex:b===e.id?10:1},onMouseDown:t=>W(t,e.id),onClick:t=>t.stopPropagation(),children:[s.jsx("img",{src:e.src,alt:"evidence",className:"w-full h-full object-contain pointer-events-none"}),b===e.id&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"absolute -top-1.5 -left-1.5 w-3 h-3 bg-blue-500 rounded-full cursor-nw-resize z-20",onMouseDown:t=>f(t,e.id,"tl")}),s.jsx("div",{className:"absolute -top-1.5 -right-1.5 w-3 h-3 bg-blue-500 rounded-full cursor-ne-resize z-20",onMouseDown:t=>f(t,e.id,"tr")}),s.jsx("div",{className:"absolute -bottom-1.5 -left-1.5 w-3 h-3 bg-blue-500 rounded-full cursor-sw-resize z-20",onMouseDown:t=>f(t,e.id,"bl")}),s.jsx("div",{className:"absolute -bottom-1.5 -right-1.5 w-3 h-3 bg-blue-500 rounded-full cursor-se-resize z-20",onMouseDown:t=>f(t,e.id,"br")}),s.jsx("div",{className:"absolute -top-1.5 left-1/2 -translate-x-1/2 w-3 h-3 bg-blue-500 rounded-full cursor-n-resize z-20",onMouseDown:t=>f(t,e.id,"t")}),s.jsx("div",{className:"absolute -bottom-1.5 left-1/2 -translate-x-1/2 w-3 h-3 bg-blue-500 rounded-full cursor-s-resize z-20",onMouseDown:t=>f(t,e.id,"b")}),s.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 -left-1.5 w-3 h-3 bg-blue-500 rounded-full cursor-w-resize z-20",onMouseDown:t=>f(t,e.id,"l")}),s.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 -right-1.5 w-3 h-3 bg-blue-500 rounded-full cursor-e-resize z-20",onMouseDown:t=>f(t,e.id,"r")}),s.jsx("button",{className:"absolute -top-3 -right-3 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 shadow-md z-30",onClick:t=>{t.stopPropagation(),V(e.id)},title:"Remove Image",children:s.jsx(B,{className:"w-3 h-3"})})]})]},e.id))]})]})};export{K as I};
