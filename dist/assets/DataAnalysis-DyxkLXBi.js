import{c as b,$ as K,a1 as q,ap as J,r as l,O as e,a9 as k,ak as A,aq as Q,S as W,Q as X,X as R,ar as z}from"./index-9EAd4Y7y.js";import{I as _}from"./ImageCanvas-B3roF_Ps.js";import{A as ee}from"./arrow-right-aIrJPY8g.js";/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=b("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=b("BrainCircuit",[["path",{d:"M12 4.5a2.5 2.5 0 0 0-4.96-.46 2.5 2.5 0 0 0-1.98 3 2.5 2.5 0 0 0-1.32 4.24 3 3 0 0 0 .34 5.58 2.5 2.5 0 0 0 2.96 3.08 2.5 2.5 0 0 0 4.91.05L12 20V4.5Z",key:"ixwj2a"}],["path",{d:"M16 8V5c0-1.1.9-2 2-2",key:"13dx7u"}],["path",{d:"M12 13h4",key:"1ku699"}],["path",{d:"M12 18h6a2 2 0 0 1 2 2v1",key:"105ag5"}],["path",{d:"M12 8h8",key:"1lhi5i"}],["path",{d:"M20.5 8a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0Z",key:"1s25gz"}],["path",{d:"M16.5 13a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0Z",key:"127460"}],["path",{d:"M20.5 21a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0Z",key:"fys062"}],["path",{d:"M18.5 3a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0Z",key:"1vib61"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S=b("Microscope",[["path",{d:"M6 18h8",key:"1borvv"}],["path",{d:"M3 22h18",key:"8prr45"}],["path",{d:"M14 22a7 7 0 1 0 0-14h-1",key:"1jwaiy"}],["path",{d:"M9 14h2",key:"197e7h"}],["path",{d:"M9 12a2 2 0 0 1-2-2V6h6v4a2 2 0 0 1-2 2Z",key:"1bmzmy"}],["path",{d:"M12 6V3a1 1 0 0 0-1-1H9a1 1 0 0 0-1 1v3",key:"1drr47"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=b("Route",[["circle",{cx:"6",cy:"19",r:"3",key:"1kj8tv"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15",key:"1d8sl"}],["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}]]),ie=()=>{const{id:T}=K(),{a3Cases:V,updateA3Case:m,isLoading:L}=q(),{user:r}=J(),a=V.find(s=>s.id===T),d=l.useRef(null),[C,g]=l.useState([]),[I,f]=l.useState(500),[M,P]=l.useState(!1),[y,v]=l.useState(null),[p,O]=l.useState(null),[H,D]=l.useState(!1),[w,j]=l.useState(null),[u,E]=l.useState(null),F=async s=>!a||!(r!=null&&r.username)?URL.createObjectURL(s):(await z.uploadA3Image(r.username,a.id,s)).url;l.useEffect(()=>{if(a){a.dataAnalysisImages&&JSON.stringify(a.dataAnalysisImages)!==JSON.stringify(C)&&g(a.dataAnalysisImages||[]),a.dataAnalysisCanvasHeight&&a.dataAnalysisCanvasHeight!==I&&f(a.dataAnalysisCanvasHeight);const s=a.dataAnalysisObservations||"";d.current&&d.current.value!==s&&(d.current.value=s)}},[a==null?void 0:a.id]),l.useEffect(()=>{if(!a||!(r!=null&&r.username)||Array.isArray(a.dataAnalysisImages)&&a.dataAnalysisImages.length>0)return;let i=!1;return(async()=>{try{const t=await z.loadA3Detail(r.username,a.id);if(!t||!t.success||i)return;const o={...a};let n=!1;Array.isArray(t.dataAnalysisImages)&&(g(t.dataAnalysisImages),o.dataAnalysisImages=t.dataAnalysisImages,n=!0),typeof t.dataAnalysisCanvasHeight=="number"&&(f(t.dataAnalysisCanvasHeight),o.dataAnalysisCanvasHeight=t.dataAnalysisCanvasHeight,n=!0),n&&m(o)}catch{}})(),()=>{i=!0}},[a==null?void 0:a.id,r==null?void 0:r.username,m]);const B=s=>{g(s),a&&m({...a,dataAnalysisImages:s})},G=s=>{f(s),a&&m({...a,dataAnalysisCanvasHeight:s})},U=()=>{if(a&&d.current){const s=d.current.value;s!==a.dataAnalysisObservations&&m({...a,dataAnalysisObservations:s})}},$=async()=>{var i,h,t,o;if(!(a!=null&&a.problemStatement))return;const s=((i=d.current)==null?void 0:i.value)||a.dataAnalysisObservations||"";if(s.trim()){P(!0),O(null),v(null);try{const n=(a.problemContext||"").trim(),N=[{role:"system",content:`You are an expert troubleshooting coach, skilled in many areas.

The user is working on an A3 Problem Solving form.

You will be given:
- A Problem Statement
- Key observations from data analysis

Your tasks:
1) Evaluate whether the current data seems adequate to understand the problem.
2) Suggest what additional data or evidence should be collected if needed.
3) Briefly discuss potential implications or likely causes suggested by the data.

Respond in English, even if the user's inputs are in another language.

Structure the answer with clear markdown headings:
## Data Adequacy
## Additional Evidence Needed
## Potential Implications of Cause`},{role:"user",content:`Problem Statement:
${a.problemStatement}`+(n?`

Additional Context:
${n}`:"")+`

Key Observations from Data:
${s}`}],x=await fetch("https://multi-model-worker.study-llm.me/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:"deepseek",messages:N,stream:!1})});if(!x.ok)throw new Error("Failed to analyze data");let c=((o=(t=(h=(await x.json()).choices)==null?void 0:h[0])==null?void 0:t.message)==null?void 0:o.content)||"";c=c.replace(/^```[\s\S]*?```/g,"").trim(),v(c)}catch{O("Failed to analyze data. Please try again.")}finally{P(!1)}}},Y=async()=>{var i,h,t,o;if(!(a!=null&&a.problemStatement))return;const s=((i=d.current)==null?void 0:i.value)||a.dataAnalysisObservations||"";D(!0),E(null),j(null);try{const n=(a.problemContext||"").trim(),N=[{role:"system",content:`You are an expert troubleshooting coach, skilled in many areas.
          
The user is working on an A3 Problem Solving form.

You will receive:
- A single Problem Statement
- Key observations from the data analysis section

Your task:
- Generate a practical troubleshooting plan to address this problem.
- Use the evidence to suggest where to focus first.
- Respond in English by default, even if the inputs are in another language.

Structure the response as clear sections with markdown headings:
1. Immediate Checks
2. Data Collection
3. Hypotheses to Test

For each bullet, be specific and actionable, but concise.`},{role:"user",content:`Problem Statement:
${a.problemStatement}`+(n?`

Additional Context:
${n}`:"")+`

Key Observations from Data:
${s}`}],x=await fetch("https://multi-model-worker.study-llm.me/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:"deepseek",messages:N,stream:!1})});if(!x.ok)throw new Error("Failed to generate troubleshooting plan");let c=((o=(t=(h=(await x.json()).choices)==null?void 0:h[0])==null?void 0:t.message)==null?void 0:o.content)||"";c=c.replace(/^```[\s\S]*?```/g,"").trim(),j(c)}catch{E("Failed to generate troubleshooting plan. Please try again.")}finally{D(!1)}};return L?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[60vh] space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-brand-200 rounded-full animate-ping opacity-20"}),e.jsx("div",{className:"relative bg-white p-4 rounded-full shadow-xl border border-brand-100",children:e.jsx(k,{className:"w-8 h-8 animate-spin text-brand-600"})})]}),e.jsx("p",{className:"text-slate-500 font-medium animate-pulse",children:"Loading analysis data..."})]}):a?e.jsxs("div",{className:"max-w-[1600px] mx-auto space-y-8 pb-20 animate-in fade-in slide-in-from-bottom-4 duration-700",children:[e.jsx("div",{className:"flex flex-col md:flex-row md:items-end justify-between gap-4 border-b border-slate-200/60 pb-6",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2.5 bg-gradient-to-br from-brand-50 to-white border border-brand-100 rounded-xl text-brand-600 shadow-sm",children:e.jsx(S,{className:"w-6 h-6"})}),e.jsx("h2",{className:"text-2xl font-bold text-slate-900 font-display tracking-tight",children:"Data Analysis"})]}),e.jsx("p",{className:"text-slate-500 text-base leading-relaxed max-w-2xl pl-1",children:"Visualize facts and evidence. Break down the problem using charts, photos, and objective observations."})]})}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-12 gap-8",children:[e.jsx("div",{className:"xl:col-span-8 space-y-6",children:e.jsxs("div",{className:"bg-white rounded-3xl border border-slate-200 shadow-sm overflow-hidden group hover:shadow-md transition-shadow duration-500",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-slate-100 bg-slate-50/50 flex justify-between items-center backdrop-blur-sm",children:[e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx(ae,{className:"w-4 h-4 text-brand-500"}),e.jsx("h3",{className:"text-sm font-bold text-slate-700 uppercase tracking-wider",children:"Visual Evidence & Charts"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs font-medium text-slate-500 bg-white px-2.5 py-1 rounded-full border border-slate-200 shadow-sm",children:[e.jsx(Q,{className:"w-3 h-3"}),e.jsx("span",{children:"Drag & Drop enabled"})]})]}),e.jsx("div",{className:"p-1.5 bg-slate-100/50",children:e.jsxs("div",{className:"bg-white rounded-2xl border border-slate-200/60 overflow-hidden relative",children:[e.jsx("div",{className:"absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/graphy.png')] opacity-[0.03] pointer-events-none mix-blend-multiply"}),e.jsx(_,{images:C,onImagesChange:B,height:I,onHeightChange:G,onUploadImage:F})]})})]})}),e.jsx("div",{className:"xl:col-span-4 space-y-6",children:e.jsxs("div",{className:"bg-white rounded-3xl border border-slate-200 shadow-sm overflow-hidden flex flex-col h-[600px] xl:h-auto xl:min-h-[500px] group hover:shadow-md transition-all duration-300 focus-within:ring-2 focus-within:ring-brand-500/10 focus-within:border-brand-400",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-slate-100 bg-slate-50/50 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx(S,{className:"w-4 h-4 text-brand-500"}),e.jsx("label",{htmlFor:"observations",className:"text-sm font-bold text-slate-700 uppercase tracking-wider",children:"Key Observations"})]}),e.jsx("span",{className:"text-xs text-slate-400 font-medium px-2",children:"Markdown supported"})]}),e.jsxs("div",{className:"flex-grow relative bg-white",children:[e.jsx("textarea",{ref:d,id:"observations",className:"w-full h-full p-6 text-slate-700 placeholder-slate-400 border-none focus:ring-0 resize-none text-base leading-relaxed font-mono bg-transparent",placeholder:`What does the data tell us?
• List facts
• Note trends
• Identify anomalies...`,defaultValue:a.dataAnalysisObservations||"",onBlur:U}),e.jsx("div",{className:"absolute bottom-4 right-4 pointer-events-none opacity-10",children:e.jsx(S,{className:"w-24 h-24 text-slate-900"})})]}),e.jsxs("div",{className:"px-6 py-4 bg-slate-50/80 border-t border-slate-100 flex flex-col sm:flex-row gap-3",children:[e.jsxs("button",{onClick:$,disabled:M||!a.problemStatement,className:"flex-1 inline-flex items-center justify-center gap-2 px-4 py-3 bg-brand-600 hover:bg-brand-700 text-white text-sm font-bold rounded-xl transition-all shadow-md hover:shadow-lg hover:-translate-y-0.5 disabled:opacity-50 disabled:translate-y-0 disabled:shadow-none group/btn relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent translate-x-[-100%] group-hover/btn:translate-x-[100%] transition-transform duration-1000"}),M?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{children:"Analyzing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"w-4 h-4"}),e.jsx("span",{children:"Analyze Data"})]})]}),e.jsx("button",{onClick:Y,disabled:H||!a.problemStatement,className:"flex-1 inline-flex items-center justify-center gap-2 px-4 py-3 bg-white text-slate-700 hover:text-brand-700 hover:bg-brand-50 border border-slate-200 hover:border-brand-200 text-sm font-bold rounded-xl transition-all shadow-sm hover:shadow-md hover:-translate-y-0.5 disabled:opacity-50 disabled:translate-y-0",children:H?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{children:"Generating..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"w-4 h-4"}),e.jsx("span",{children:"Generate Plan"})]})})]})]})})]}),(y||p||w||u)&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 animate-in fade-in slide-in-from-bottom-8 duration-700 delay-100",children:[(y||p)&&e.jsxs("div",{className:"group relative",children:[e.jsx("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-brand-500 to-indigo-500 rounded-3xl opacity-20 blur group-hover:opacity-40 transition duration-500"}),e.jsxs("div",{className:"relative bg-white rounded-2xl border border-slate-200 shadow-xl overflow-hidden flex flex-col h-full",children:[e.jsxs("div",{className:"bg-gradient-to-r from-brand-600 to-indigo-600 px-6 py-4 flex justify-between items-center shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2.5 text-white",children:[e.jsx("div",{className:"p-1.5 bg-white/20 rounded-lg backdrop-blur-sm",children:e.jsx(X,{className:"w-4 h-4"})}),e.jsx("h3",{className:"text-sm font-bold uppercase tracking-wider text-shadow-sm",children:"AI Data Insights"})]}),e.jsx("button",{onClick:()=>v(null),className:"p-1.5 text-white/70 hover:text-white hover:bg-white/20 rounded-lg transition-all",children:e.jsx(R,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"p-8 flex-grow",children:p?e.jsxs("div",{className:"flex items-center gap-3 text-red-600 bg-red-50 p-6 rounded-2xl border border-red-100",children:[e.jsx(A,{className:"w-6 h-6 shrink-0"}),e.jsx("p",{className:"text-sm font-medium",children:p})]}):e.jsx("div",{className:"prose prose-slate prose-sm max-w-none text-slate-600 leading-relaxed",children:e.jsx("div",{className:"whitespace-pre-wrap",children:y})})}),e.jsxs("div",{className:"px-6 py-4 bg-slate-50 border-t border-slate-100 text-xs text-slate-400 font-medium flex justify-between items-center",children:[e.jsx("span",{children:"Generated by AI Coach"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-slate-300"}),e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-slate-300"}),e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-slate-300"})]})]})]})]}),(w||u)&&e.jsxs("div",{className:"group relative",children:[e.jsx("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-emerald-500 to-teal-500 rounded-3xl opacity-20 blur group-hover:opacity-40 transition duration-500"}),e.jsxs("div",{className:"relative bg-white rounded-2xl border border-slate-200 shadow-xl overflow-hidden flex flex-col h-full",children:[e.jsxs("div",{className:"bg-gradient-to-r from-emerald-600 to-teal-600 px-6 py-4 flex justify-between items-center shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2.5 text-white",children:[e.jsx("div",{className:"p-1.5 bg-white/20 rounded-lg backdrop-blur-sm",children:e.jsx(te,{className:"w-4 h-4"})}),e.jsx("h3",{className:"text-sm font-bold uppercase tracking-wider text-shadow-sm",children:"Troubleshooting Plan"})]}),e.jsx("button",{onClick:()=>j(null),className:"p-1.5 text-white/70 hover:text-white hover:bg-white/20 rounded-lg transition-all",children:e.jsx(R,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"p-8 flex-grow",children:u?e.jsxs("div",{className:"flex items-center gap-3 text-red-600 bg-red-50 p-6 rounded-2xl border border-red-100",children:[e.jsx(A,{className:"w-6 h-6 shrink-0"}),e.jsx("p",{className:"text-sm font-medium",children:u})]}):e.jsx("div",{className:"prose prose-slate prose-sm max-w-none text-slate-600 leading-relaxed",children:e.jsx("div",{className:"whitespace-pre-wrap",children:w})})}),e.jsxs("div",{className:"px-6 py-4 bg-slate-50 border-t border-slate-100 text-xs text-slate-400 font-medium flex justify-between items-center",children:[e.jsx("span",{children:"Suggested Action Plan"}),e.jsxs("div",{className:"flex gap-2 items-center text-emerald-600 font-bold cursor-pointer hover:underline",children:[e.jsx("span",{children:"View Details"}),e.jsx(ee,{className:"w-3 h-3"})]})]})]})]})]})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[60vh] space-y-6 text-center px-4",children:[e.jsx("div",{className:"w-20 h-20 bg-red-50 text-red-500 rounded-3xl flex items-center justify-center mb-4 shadow-sm border border-red-100 rotate-3",children:e.jsx(A,{className:"w-10 h-10"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-2xl font-bold text-slate-900",children:"Case not found"}),e.jsx("p",{className:"text-slate-500 max-w-md mx-auto",children:"The A3 case you are looking for may have been deleted or you don't have permission to view it."})]}),e.jsx("button",{onClick:()=>window.history.back(),className:"px-6 py-2.5 bg-white border border-slate-200 text-slate-700 font-medium rounded-xl hover:bg-slate-50 hover:border-slate-300 transition-all shadow-sm",children:"Go Back"})]})};export{ie as default};
