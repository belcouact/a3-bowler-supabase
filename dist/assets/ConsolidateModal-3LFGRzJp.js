import{r as v,aE as E,W as T,Y as F,O as s,X as L,a1 as M,aJ as O}from"./index-iQ4eGfgo.js";const U=({isOpen:A,onClose:f})=>{const[g,w]=v.useState(""),[h,y]=v.useState(!1),{user:p}=E(),{bowlers:j,a3Cases:N,reorderBowlers:B,reorderA3Cases:S}=T(),a=F();if(!A)return null;const C=(o,l)=>{const t=new Set(l.map(r=>r.id)),n=o.map((r,c)=>t.has(r.id)?c:-1).filter(r=>r!==-1),i=o.filter(r=>!t.has(r.id));if(n.length===0)return[...i,...l];const u=Math.min(...n),m=o.slice(0,u).filter(r=>!t.has(r.id)).length,d=[...i];return d.splice(m,0,...l),d},I=async o=>{if(o.preventDefault(),(p==null?void 0:p.role)!=="admin"){a.error("Only administrators can perform this action.");return}if(!g.trim()){a.error("Please enter at least one tag.");return}const l=g.split(",").map(t=>t.trim()).filter(t=>t.length>0);if(l.length===0){a.error("Please enter valid tags.");return}y(!0);try{const t=await O.consolidateBowlers(l);if(t.success){const n=t.bowlers||[],i=t.a3Cases||[],u=new Set(j.map(e=>e.id)),m=new Set(N.map(e=>e.id)),d=n.filter(e=>!u.has(e.id)).length,r=n.filter(e=>u.has(e.id)).length,c=i.filter(e=>!m.has(e.id)).length,x=i.filter(e=>m.has(e.id)).length,$=d+c,k=r+x;if($>0||k>0){if(n.length>0){const b=C(j,n);B(b)}if(i.length>0){const b=C(N,i);S(b)}const e=[];d>0&&e.push(`${d} bowlers added`),r>0&&e.push(`${r} bowlers updated`),c>0&&e.push(`${c} A3s added`),x>0&&e.push(`${x} A3s updated`),a.success(`Successfully consolidated: ${e.join(", ")}.`)}else a.info("No new or updated items found with these tags.");f(),w("")}else a.error("Failed to consolidate items.")}catch(t){console.error("Consolidate error:",t),a.error("An error occurred during consolidation.")}finally{y(!1)}};return s.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center bg-black bg-opacity-50",children:s.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md mx-4",children:[s.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-gray-200",children:[s.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Consolidate Bowlers"}),s.jsx("button",{onClick:f,className:"text-gray-400 hover:text-gray-500 transition-colors",children:s.jsx(L,{className:"w-5 h-5"})})]}),s.jsxs("form",{onSubmit:I,className:"p-4",children:[s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{htmlFor:"tags",className:"block text-sm font-medium text-gray-700 mb-1",children:"Tag (comma separated)"}),s.jsx("input",{type:"text",id:"tags",value:g,onChange:o=>w(o.target.value),placeholder:"e.g. Technical, Urgent, Q1",className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",autoFocus:!0}),s.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Enter tags to filter and consolidate bowlers and A3 cases from the database."})]}),s.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[s.jsx("button",{type:"button",onClick:f,className:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",disabled:h,children:"Cancel"}),s.jsxs("button",{type:"submit",disabled:h,className:"px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 flex items-center",children:[h&&s.jsx(M,{className:"w-4 h-4 mr-2 animate-spin"}),"Consolidate"]})]})]})]})})};export{U as ConsolidateModal};
