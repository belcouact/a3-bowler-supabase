import{W as j,Z as H,aj as C,r as i,O as a,a4 as N,ak as h}from"./index-CrxhOlNg.js";import{I as R}from"./ImageCanvas-DpBIy5q-.js";const U=()=>{const{id:x}=j(),{a3Cases:p,updateA3Case:n}=H(),{user:t}=C(),e=p.find(s=>s.id===x),l=i.useRef(null),[g,u]=i.useState([]),[f,c]=i.useState(500),v=async s=>!e||!(t!=null&&t.username)?URL.createObjectURL(s):(await h.uploadA3Image(t.username,e.id,s)).url;i.useEffect(()=>{if(e){e.resultImages&&JSON.stringify(e.resultImages)!==JSON.stringify(g)&&u(e.resultImages||[]),e.resultCanvasHeight&&e.resultCanvasHeight!==f&&c(e.resultCanvasHeight);const s=e.results||"";l.current&&l.current.value!==s&&(l.current.value=s)}},[e==null?void 0:e.id]),i.useEffect(()=>{if(!e||!(t!=null&&t.username)||Array.isArray(e.resultImages)&&e.resultImages.length>0)return;let o=!1;return(async()=>{try{const r=await h.loadA3Detail(t.username,e.id);if(!r||!r.success||o)return;const m={...e};let d=!1;Array.isArray(r.resultImages)&&(u(r.resultImages),m.resultImages=r.resultImages,d=!0),typeof r.resultCanvasHeight=="number"&&(c(r.resultCanvasHeight),m.resultCanvasHeight=r.resultCanvasHeight,d=!0),d&&n(m)}catch{}})(),()=>{o=!0}},[e==null?void 0:e.id,t==null?void 0:t.username,n]);const y=s=>{u(s),e&&n({...e,resultImages:s})},I=s=>{c(s),e&&n({...e,resultCanvasHeight:s})},b=()=>{if(e&&l.current){const s=l.current.value;s!==e.results&&n({...e,results:s})}};return e?a.jsx("div",{className:"space-y-6",children:a.jsxs("div",{children:[a.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Results & Follow-up"}),a.jsx("p",{className:"text-gray-500 mb-4",children:"Document the results achieved after implementing the action plan."}),a.jsx(R,{images:g,onImagesChange:y,height:f,onHeightChange:I,label:"Result Evidence (Paste or Upload Images)",onUploadImage:v}),a.jsx("div",{className:"space-y-4 mt-6",children:a.jsxs("div",{children:[a.jsx("label",{htmlFor:"results",className:"block text-sm font-medium text-gray-700 mb-1",children:"Actual Results"}),a.jsx("textarea",{ref:l,id:"results",rows:8,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-3 border",placeholder:"Describe what happened after actions were taken...",defaultValue:e.results||"",onBlur:b})]})})]})}):a.jsx("div",{className:"flex items-center justify-center py-16",children:a.jsxs("div",{className:"flex flex-col items-center",children:[a.jsx(N,{className:"w-8 h-8 animate-spin text-blue-600"}),a.jsx("p",{className:"mt-3 text-base font-medium text-gray-700",children:"Loading application data..."})]})})};export{U as default};
