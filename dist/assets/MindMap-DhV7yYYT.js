import{c as V,r as l,O as r,d as B,aj as F,aa as ee}from"./index--O4BBDcs.js";import{Z as te,a as re}from"./zoom-out-VZgSLub0.js";import{T as se}from"./trash-2-abbdZrRh.js";/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=V("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]),b=200,g=80,q=[{name:"White",value:"#ffffff",border:"#e2e8f0"},{name:"Blue",value:"#eff6ff",border:"#bfdbfe"},{name:"Green",value:"#f0fdf4",border:"#bbf7d0"},{name:"Yellow",value:"#fefce8",border:"#fef08a"},{name:"Red",value:"#fef2f2",border:"#fecaca"},{name:"Purple",value:"#faf5ff",border:"#e9d5ff"}],ne=({node:t,onUpdate:p,onAdd:M,onDelete:P,onMouseDown:S})=>{var H;const m=l.useRef(null),a=l.useRef(null),[y,f]=l.useState(!1),j=l.useRef(t);l.useLayoutEffect(()=>{j.current=t}),l.useLayoutEffect(()=>{if(m.current&&!t.customHeight){m.current.style.height="auto";const s=m.current.scrollHeight;m.current.style.height=s+"px"}},[t.text,t.customHeight]),l.useEffect(()=>{if(!a.current)return;const s=new ResizeObserver(C=>{for(const E of C)requestAnimationFrame(()=>{const k=E.target,w=j.current,v=k.offsetWidth,d=k.offsetHeight;(Math.abs((w.width||b)-v)>5||Math.abs((w.height||g)-d)>5)&&p(w.id,{width:v,height:d})})});return s.observe(a.current),()=>s.disconnect()},[p]);const N=s=>{var Y,X;s.stopPropagation(),s.preventDefault();const C=s.clientX,E=s.clientY,k=((Y=a.current)==null?void 0:Y.offsetWidth)||b,w=((X=a.current)==null?void 0:X.offsetHeight)||g,v=z=>{const $=z.clientX-C,L=z.clientY-E,I=Math.max(100,k+$),W=Math.max(50,w+L);p(t.id,{customWidth:I,customHeight:W,width:I,height:W})},d=()=>{window.removeEventListener("mousemove",v),window.removeEventListener("mouseup",d)};window.addEventListener("mousemove",v),window.addEventListener("mouseup",d)};return r.jsxs("div",{ref:a,style:{transform:`translate(${t.x}px, ${t.y}px)`,width:t.customWidth||b,height:t.customHeight,backgroundColor:t.color||(t.type==="root"?"#eff6ff":"#ffffff"),borderColor:t.color?(H=q.find(s=>s.value===t.color))==null?void 0:H.border:void 0},className:B("absolute flex flex-col p-3 rounded-lg shadow-sm border transition-shadow group select-none",!t.color&&(t.type==="root"?"bg-blue-50 border-blue-200":"bg-white border-slate-200 hover:border-blue-300")),children:[r.jsxs("div",{className:"flex justify-between items-center mb-2 cursor-grab active:cursor-grabbing border-b border-transparent group-hover:border-slate-100 pb-1 relative",onMouseDown:s=>S(s,t.id),children:[r.jsx("span",{className:"text-[10px] font-bold uppercase tracking-wider text-slate-400",children:t.type==="root"?"PROBLEM":"WHY?"}),r.jsxs("div",{className:"flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity items-center",children:[r.jsxs("div",{className:"relative",children:[r.jsx("button",{onClick:s=>{s.stopPropagation(),f(!y)},className:"p-1 hover:bg-slate-100 text-slate-400 hover:text-slate-600 rounded",title:"Change Color",children:r.jsx(oe,{className:"w-3 h-3"})}),y&&r.jsx("div",{className:"absolute top-full right-0 mt-1 p-2 bg-white rounded-lg shadow-xl border border-gray-200 flex gap-1 z-[70] min-w-[140px] flex-wrap",onMouseDown:s=>s.stopPropagation(),children:q.map(s=>r.jsx("button",{className:"w-6 h-6 rounded-full border border-gray-200 hover:scale-110 transition-transform",style:{backgroundColor:s.value},onClick:C=>{C.stopPropagation(),p(t.id,{color:s.value}),f(!1)},title:s.name},s.name))})]}),t.type!=="root"&&r.jsx("button",{onClick:()=>P(t.id),className:"p-1 hover:bg-red-50 text-slate-400 hover:text-red-500 rounded",title:"Delete branch",children:r.jsx(se,{className:"w-3 h-3"})}),r.jsx("button",{onClick:()=>M(t.id,"right"),className:"p-1 hover:bg-blue-50 text-slate-400 hover:text-blue-500 rounded",title:"Add next Why (Right)",children:r.jsx(F,{className:"w-3 h-3"})})]})]}),r.jsx("textarea",{ref:m,value:t.text,onChange:s=>p(t.id,{text:s.target.value}),style:{height:t.customHeight?"100%":void 0,resize:"none"},className:B("w-full text-sm bg-transparent border-none focus:ring-0 p-0 text-slate-700 font-medium overflow-hidden",t.customHeight?"flex-1":""),rows:1,placeholder:t.type==="root"?"Describe the problem...":"Ask why...",onMouseDown:s=>s.stopPropagation()}),r.jsx("div",{className:"absolute bottom-0 right-0 w-4 h-4 cursor-se-resize flex items-center justify-center opacity-0 group-hover:opacity-100 z-20",onMouseDown:N,title:"Resize",children:r.jsx("div",{className:"w-2 h-2 border-r-2 border-b-2 border-slate-300"})}),r.jsx("button",{className:"absolute -bottom-3 left-1/2 transform -translate-x-1/2 bg-white border border-slate-200 rounded-full p-1 shadow-sm opacity-0 group-hover:opacity-100 transition-opacity hover:bg-blue-50 text-slate-400 hover:text-blue-500 z-10",onClick:()=>M(t.id,"bottom"),title:"Add Why below",children:r.jsx(F,{className:"w-3 h-3"})})]})},ie=({initialNodes:t,onChange:p,autoHeight:M,initialScale:P,fixedHeight:S,onViewChange:m})=>{const[a,y]=l.useState(t&&t.length>0?t:[{id:"root",text:"Define the Problem",x:50,y:250,width:b,height:g,parentId:null,type:"root"}]),[f,j]=l.useState(P??1),[N,H]=l.useState(null),[s,C]=l.useState({x:0,y:0}),[E,k]=l.useState(!1),w=l.useRef({x:0,y:0}),v=l.useRef([]),d=l.useRef(null),Y=l.useRef(p),[X,z]=l.useState(600);l.useEffect(()=>{Y.current=p},[p]),l.useEffect(()=>{Y.current&&Y.current(a)},[a]),l.useEffect(()=>{if(!M||a.length===0)return;const e=Math.min(...a.map(o=>o.y)),n=Math.max(...a.map(o=>o.y+(o.height||g)))-e+100;z(Math.max(300,n))},[a,M]),l.useEffect(()=>{t&&t.length>0&&N===null&&(y(e=>e===t||JSON.stringify(e)===JSON.stringify(t)?e:t),j(P!==void 0?P:1))},[t,N,P]);const $=(e,c)=>{e.stopPropagation();const n=a.find(i=>i.id===c);if(!n||!d.current)return;const o=d.current.getBoundingClientRect(),u=(e.clientX-o.left)/f,h=(e.clientY-o.top)/f;C({x:u-n.x,y:h-n.y}),H(c)},L=e=>{e.button===0&&(N||(k(!0),w.current={x:e.clientX,y:e.clientY},v.current=a))},I=e=>{if(E){const u=(e.clientX-w.current.x)/f,h=(e.clientY-w.current.y)/f,i=v.current;y(i.map(x=>({...x,x:x.x+u,y:x.y+h})));return}if(!N||!d.current)return;const c=d.current.getBoundingClientRect(),n=(e.clientX-c.left)/f,o=(e.clientY-c.top)/f;y(a.map(u=>u.id===N?{...u,x:n-s.x,y:o-s.y}:u))},W=()=>{H(null),k(!1)},G=(e,c)=>{const n=a.find(u=>u.id===e);if(!n)return;const o={id:ee(),text:"Why?",x:0,y:0,width:b,height:g,parentId:e,type:"child"};if(c==="bottom"){o.x=n.x,o.y=n.y+(n.height||g)+50;const u=a.filter(h=>h.parentId===e&&h.y>n.y+(n.height||g)/2);if(u.length>0){const h=Math.max(...u.map(i=>i.x));o.x=h+(b+20)}}else{o.x=n.x+(n.width||b)+50,o.y=n.y;const u=a.filter(h=>h.parentId===e&&h.x>n.x+(n.width||b)/2);if(u.length>0){const h=Math.max(...u.map(i=>i.y));o.y=h+(g+20)}}y([...a,o])},J=e=>{const c=o=>{const u=a.filter(i=>i.parentId===o);let h=u.map(i=>i.id);return u.forEach(i=>{h=[...h,...c(i.id)]}),h},n=[e,...c(e)];y(a.filter(o=>!n.includes(o.id)))},U=l.useCallback((e,c)=>{y(n=>n.map(o=>o.id===e?{...o,...c}:o))},[]),_=()=>a.map(e=>{if(!e.parentId)return null;const c=a.find(Q=>Q.id===e.parentId);if(!c)return null;const n=c.width||b,o=c.height||g,u=e.width||b,h=e.height||g;let i,x,R,D,O,T,A,Z;e.y>=c.y+o-10?(i=c.x+n/2,x=c.y+o,R=e.x+u/2,D=e.y,O=i,T=x+(D-x)/2,A=R,Z=D-(D-x)/2):(i=c.x+n,x=c.y+o/2,R=e.x,D=e.y+h/2,O=i+(R-i)/2,T=x,A=R-(R-i)/2,Z=D);const K=`M ${i} ${x} C ${O} ${T}, ${A} ${Z}, ${R} ${D}`;return r.jsx("path",{d:K,stroke:"#475569",strokeWidth:"3",fill:"none"},`${c.id}-${e.id}`)});return r.jsx("div",{className:"flex flex-col space-y-2",children:r.jsxs("div",{ref:d,className:B("w-full bg-slate-50 relative overflow-hidden border border-slate-200 rounded-lg cursor-grab active:cursor-grabbing resize-y",!M&&"h-[600px]"),onMouseDown:L,style:M?{height:X}:S?{height:S}:void 0,onMouseMove:I,onMouseUp:W,onMouseLeave:W,children:[r.jsxs("div",{className:"absolute top-4 right-4 z-20 flex items-center bg-white/80 rounded-md p-1 shadow backdrop-blur-sm border border-slate-200",children:[r.jsx("button",{onClick:()=>{const e=Math.max(.5,f-.1);j(e),m&&d.current&&m({scale:e,height:d.current.clientHeight})},className:"p-1 hover:bg-gray-100 rounded",title:"Zoom Out",children:r.jsx(te,{className:"w-4 h-4 text-gray-600"})}),r.jsxs("span",{className:"text-xs text-gray-500 w-12 text-center select-none",children:[Math.round(f*100),"%"]}),r.jsx("button",{onClick:()=>{const e=Math.min(2,f+.1);j(e),m&&d.current&&m({scale:e,height:d.current.clientHeight})},className:"p-1 hover:bg-gray-100 rounded",title:"Zoom In",children:r.jsx(re,{className:"w-4 h-4 text-gray-600"})})]}),r.jsxs("div",{style:{transform:`scale(${f})`,transformOrigin:"0 0",width:"100%",height:"100%",position:"relative"},children:[r.jsx("svg",{className:"absolute top-0 left-0 w-full h-full pointer-events-none",style:{overflow:"visible",zIndex:0},width:"100%",height:"100%",children:_()}),r.jsx("div",{className:"relative",style:{zIndex:10},children:a.map(e=>r.jsx(ne,{node:e,onUpdate:U,onAdd:G,onDelete:J,onMouseDown:$},e.id))})]})]})})};export{ie as M};
