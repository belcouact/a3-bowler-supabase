import{V as I,Y as E,r,O as t,a3 as v,ah as O,S as P,X as R}from"./index-Cef_4xOS.js";import{M as F}from"./MindMap-CFXY1X9N.js";import{A as H}from"./alert-circle-BU5Hr5hw.js";import"./zoom-out-K9NIWRqu.js";import"./trash-2-B4adtUpx.js";const V=()=>{const{id:w}=I(),{a3Cases:C,updateA3Case:l}=E(),e=C.find(s=>s.id===w),[h,f]=r.useState(""),[g,b]=r.useState(!1),[y,x]=r.useState(null),[N,j]=r.useState(null);r.useEffect(()=>{e&&e.rootCause!==h&&f(e.rootCause||"")},[e]),r.useEffect(()=>{if(!(e!=null&&e.mindMapNodes))return;const s=e.mindMapNodes;if(s.length===0)return;const n=s.filter(a=>!a.parentId);let o="";const d=(a,c)=>{const m=s.filter(i=>i.parentId===a);m.sort((i,u)=>i.y-u.y);for(const i of m){const u="  ".repeat(c);o+=`${u}- ${i.text}
`,d(i.id,c+1)}};n.sort((a,c)=>a.y-c.y);for(const a of n)o+=`${a.text}
`,d(a.id,1);o!==e.mindMapText&&l({...e,mindMapText:o})},[e==null?void 0:e.mindMapNodes,l,e==null?void 0:e.id]);const S=r.useCallback(s=>{if(!e)return;const n=JSON.stringify(e.mindMapNodes),o=JSON.stringify(s);n!==o&&l({...e,mindMapNodes:s})},[e,l]),A=r.useCallback(s=>{if(!e)return;const n=s.scale,o=s.height,d=e.mindMapScale??1,a=e.mindMapCanvasHeight;d===n&&a===o||l({...e,mindMapScale:n,mindMapCanvasHeight:o})},[e,l]),M=s=>{const n=s.target.value;f(n),e&&l({...e,rootCause:n})},k=async()=>{var d,a,c;if(!e)return;const s=e.problemStatement||"",n=e.dataAnalysisObservations||"",o=h||e.rootCause||"";if(!(!s.trim()||!o.trim())){b(!0),j(null),x(null);try{const m=[{role:"system",content:`You are an expert continuous improvement and operations coach.

You will receive:
- A3 Problem Statement
- Key observations from data analysis
- Identified root cause

Your task is to propose practical improvement actions that address the root cause.

Respond in English, even if the user's inputs are in another language.

Structure the answer with markdown headings:
## Short-term Actions
## Long-term Actions

Under each heading, list concise, actionable bullet points. Focus on actions that are realistic in a manufacturing or service environment.`},{role:"user",content:`Problem Statement:
${s}

Key Observations from Data:
${n}

Identified Root Cause:
${o}`}],i=await fetch("https://multi-model-worker.study-llm.me/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:"deepseek",messages:m,stream:!1})});if(!i.ok)throw new Error("Failed to generate improvement actions");let p=((c=(a=(d=(await i.json()).choices)==null?void 0:d[0])==null?void 0:a.message)==null?void 0:c.content)||"";p=p.replace(/^```[\s\S]*?```/g,"").trim(),x(p)}catch{j("Failed to generate improvement actions. Please try again.")}finally{b(!1)}}};return e?t.jsxs("div",{className:"space-y-6 w-full flex flex-col",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"5 Whys Analysis"}),t.jsx("p",{className:"text-gray-500 mb-4",children:'Interactive Root Cause Analysis. Start with the problem and drill down by adding "Why" nodes.'})]}),t.jsx("div",{className:"flex flex-col",children:t.jsx(F,{initialNodes:e.mindMapNodes,onChange:S,initialScale:e.mindMapScale,fixedHeight:e.mindMapCanvasHeight,onViewChange:A})}),t.jsxs("div",{className:"mt-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("label",{htmlFor:"rootCause",className:"block text-sm font-medium text-gray-700",children:"Identified Root Cause"}),t.jsx("button",{type:"button",onClick:k,disabled:g||!e.problemStatement||!(h||e.rootCause),className:"inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md shadow-sm text-indigo-700 bg-indigo-50 hover:bg-indigo-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed",children:g?t.jsxs(t.Fragment,{children:[t.jsx(v,{className:"animate-spin -ml-0.5 mr-2 h-3 w-3"}),t.jsx("span",{className:"hidden sm:inline",children:"Generating actions..."})]}):t.jsxs(t.Fragment,{children:[t.jsx(O,{className:"-ml-0.5 mr-0 sm:mr-2 h-3 w-3"}),t.jsx("span",{className:"hidden sm:inline",children:"AI Improvement Actions"})]})})]}),t.jsx("textarea",{id:"rootCause",rows:8,className:"shadow-sm focus:ring-blue-500 focus:border-blue-500 block w-full sm:text-sm border-gray-300 rounded-md p-2 border",placeholder:"Summarize the root cause identified from the analysis...",value:h,onChange:M}),N&&t.jsx("div",{className:"mt-3 rounded-md bg-red-50 p-3",children:t.jsxs("div",{className:"flex",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx(H,{className:"h-4 w-4 text-red-400","aria-hidden":"true"})}),t.jsx("div",{className:"ml-2 text-sm text-red-700",children:N})]})}),y&&t.jsxs("div",{className:"mt-4 bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden",children:[t.jsxs("div",{className:"bg-blue-50 px-4 py-2 border-b border-gray-200 flex items-center justify-between",children:[t.jsxs("h3",{className:"text-xs font-bold text-blue-900 flex items-center",children:[t.jsx(P,{className:"h-4 w-4 mr-2 text-blue-600"}),"AI Improvement Actions"]}),t.jsx("button",{type:"button",className:"text-gray-400 hover:text-gray-500",onClick:()=>x(null),children:t.jsx(R,{className:"h-4 w-4"})})]}),t.jsx("div",{className:"p-4",children:t.jsx("div",{className:"prose prose-sm max-w-none text-gray-700 bg-gray-50 p-3 rounded-md text-sm whitespace-pre-wrap",children:y})})]})]})]}):t.jsx("div",{className:"flex items-center justify-center py-16",children:t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx(v,{className:"w-8 h-8 animate-spin text-blue-600"}),t.jsx("p",{className:"mt-3 text-base font-medium text-gray-700",children:"Loading application data..."})]})})};export{V as default};
