import{c as z,W as H,Y as P,r as n,O as e,a3 as N,S as R}from"./index-BOSSAdGq.js";import{I as D}from"./ImageCanvas-Dek48vWh.js";import{A as V}from"./alert-circle-4htXVL2v.js";/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=z("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),J=()=>{var f;const{id:S}=H(),{a3Cases:k,updateA3Case:i}=P(),a=k.find(s=>s.id===S),t=n.useRef(null),[l,d]=n.useState([]),[o,c]=n.useState(500),[m,h]=n.useState(!1),[u,g]=n.useState(null),[x,y]=n.useState(null);n.useEffect(()=>{if(a){a.dataAnalysisImages&&JSON.stringify(a.dataAnalysisImages)!==JSON.stringify(l)&&d(a.dataAnalysisImages||[]),a.dataAnalysisCanvasHeight&&a.dataAnalysisCanvasHeight!==o&&c(a.dataAnalysisCanvasHeight);const s=a.dataAnalysisObservations||"";t.current&&t.current.value!==s&&(t.current.value=s)}},[a==null?void 0:a.id]);const C=s=>{d(s),a&&i({...a,dataAnalysisImages:s})},I=s=>{c(s),a&&i({...a,dataAnalysisCanvasHeight:s})},O=()=>{if(a&&t.current){const s=t.current.value;s!==a.dataAnalysisObservations&&i({...a,dataAnalysisObservations:s})}},E=async()=>{var p,b,v,j;if(!(a!=null&&a.problemStatement))return;const s=((p=t.current)==null?void 0:p.value)||a.dataAnalysisObservations||"";if(s.trim()){h(!0),y(null),g(null);try{const A=[{role:"system",content:`You are an expert troubleshooting coach, skilled in many areas.

The user is working on an A3 Problem Solving form.

You will be given:
- A Problem Statement
- Key observations from data analysis

Your tasks:
1) Evaluate whether the current data seems adequate to understand the problem.
2) Suggest what additional data or evidence should be collected if needed.
3) Briefly discuss potential implications or likely causes suggested by the data.

Respond in English, even if the user's inputs are in another language.

Structure the answer with clear markdown headings:
## Data Adequacy
## Additional Evidence Needed
## Potential Implications of Cause`},{role:"user",content:`Problem Statement: "${a.problemStatement}"

Key Observations from Data:
${s}`}],w=await fetch("https://multi-model-worker.study-llm.me/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:"deepseek",messages:A,stream:!1})});if(!w.ok)throw new Error("Failed to analyze data");let r=((j=(v=(b=(await w.json()).choices)==null?void 0:b[0])==null?void 0:v.message)==null?void 0:j.content)||"";r=r.replace(/^```[\s\S]*?```/g,"").trim(),g(r)}catch{y("Failed to analyze data. Please try again.")}finally{h(!1)}}};return a?e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Data Analysis"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Visualize the data to understand the magnitude and trend of the problem."}),e.jsx(D,{images:l,onImagesChange:C,height:o,onHeightChange:I}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{htmlFor:"observations",className:"block text-sm font-medium text-gray-700",children:"Key Observations from Data"}),e.jsx("button",{type:"button",onClick:E,disabled:m||!a.problemStatement||!((f=t.current)!=null&&f.value||a.dataAnalysisObservations),className:"inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md shadow-sm text-indigo-700 bg-indigo-50 hover:bg-indigo-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed",children:m?e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"animate-spin -ml-0.5 mr-2 h-3 w-3"}),e.jsx("span",{className:"hidden sm:inline",children:"Analyzing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"-ml-0.5 mr-0 sm:mr-2 h-3 w-3"}),e.jsx("span",{className:"hidden sm:inline",children:"AI Evidence Review"})]})})]}),e.jsx("textarea",{ref:t,id:"observations",rows:8,className:"w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm p-3 border",placeholder:"What patterns or insights do you see in the data?",defaultValue:a.dataAnalysisObservations||"",onBlur:O}),x&&e.jsx("div",{className:"mt-3 rounded-md bg-red-50 p-3",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(V,{className:"h-4 w-4 text-red-400","aria-hidden":"true"})}),e.jsx("div",{className:"ml-2 text-sm text-red-700",children:x})]})}),u&&e.jsxs("div",{className:"mt-4 bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden",children:[e.jsx("div",{className:"bg-indigo-50 px-4 py-2 border-b border-gray-200",children:e.jsxs("h3",{className:"text-xs font-bold text-indigo-900 flex items-center",children:[e.jsx(R,{className:"h-4 w-4 mr-2 text-indigo-600"}),"AI Evidence Adequacy & Cause Insight"]})}),e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"prose prose-sm max-w-none text-gray-700 bg-gray-50 p-3 rounded-md text-sm whitespace-pre-wrap",children:u})})]})]})]})}):e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(N,{className:"w-8 h-8 animate-spin text-blue-600"}),e.jsx("p",{className:"mt-3 text-base font-medium text-gray-700",children:"Loading application data..."})]})})};export{J as default};
